<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>aws on pinkhello</title><link>https://pinkhello.cc/tags/aws/</link><description>Recent content in aws on pinkhello</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><copyright>pinkhello</copyright><lastBuildDate>Fri, 27 Aug 2021 17:58:15 +0800</lastBuildDate><atom:link href="https://pinkhello.cc/tags/aws/index.xml" rel="self" type="application/rss+xml"/><item><title>Aws上mongo备份进入S3</title><link>https://pinkhello.cc/posts/34-aws%E4%B8%8Amongo%E5%A4%87%E4%BB%BD%E8%BF%9B%E5%85%A5s3/</link><pubDate>Fri, 27 Aug 2021 17:58:15 +0800</pubDate><guid>https://pinkhello.cc/posts/34-aws%E4%B8%8Amongo%E5%A4%87%E4%BB%BD%E8%BF%9B%E5%85%A5s3/</guid><description>机器准备 开启新机器, 注意需要备份的数据量。选择磁盘或者数据盘大小 老机器上, 磁盘在线需要扩容的话注意执行扩容，让设备分区和文件系统都识别 云台上选择需要扩容的磁盘扩大到需要的大小（当前机器上还无法直接使用）
进入机器控制台
# lsblk 查看磁盘大小 # lsblk -f 查看磁盘大小以及类型 # df -lh # lsblk # sudo growpart 磁盘设备名称 1 # sudo resize2fs 磁盘文件系统 # df -lh df -lh lsblk lsblk -f sudo growpart /dev/nvme0n1 1 sudo resize2fs /dev/nvme0n1p1 备份脚本准备 backup.sh 备份脚本 #!/bin/bash # 公共 function 日志日期格式 get_date () { date +[%Y-%m-%d\ %H:%M:%S] } ARCHIVE_OUT=$BACKUP_FILENAME_PREFIX-$(date +$BACKUP_FILENAME_DATE_FORMAT).tgz echo &amp;#34;ARCHIVE_OUT=$ARCHIVE_OUT&amp;#34; # 生成POST请求数据 generate_post_data () { cat &amp;lt;&amp;lt;EOF { &amp;#34;group&amp;#34;:&amp;#34;alert-XXX&amp;#34;, &amp;#34;project&amp;#34;:&amp;#34;$S3_PATH$ARCHIVE_OUT&amp;#34;, &amp;#34;alert_message&amp;#34;:&amp;#34;备份mongo2s3错误&amp;#34; } EOF } # Script echo &amp;#34;$(get_date) Mongo backup started&amp;#34; echo &amp;#34;$(get_date) [Step 1/4] Running mongodump: mongodump --forceTableScan -h $MONGO_HOST $MONGO_DB_ARG -u $MONGO_USERNAME -p $MONGO_PASSWORD --authenticationDatabase admin&amp;#34; # mongodump --quiet -h $MONGO_HOST:$MONGO_PORT $MONGO_DB_ARG -u $MONGO_USERNAME -p $MONGO_PASSWORD --authenticationDatabase admin mongodump --forceTableScan -h $MONGO_HOST $MONGO_DB_ARG -u $MONGO_USERNAME -p $MONGO_PASSWORD --authenticationDatabase admin echo &amp;#34;$(get_date) [Step 2/4] check dump directory: curl feishu .</description></item></channel></rss>