<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script><link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>分布式系统下的日志收集分析方案 | pinkhello</title>
<link rel=canonical href=https://pinkhello.cc/posts/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%8B%E7%9A%84%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%88%86%E6%9E%90%E6%96%B9%E6%A1%88/><meta name=description content="👷Hey! 我是 **pinkhello**，💻 一名后端程序员。**重要提示**: 在您阅读文章并评论之前，请先认真阅读[**评论承诺**](http://pinkhello.cc/promise)。"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="分布式系统下的日志收集分析方案"><meta property="og:description" content="前言 分布式系统下，大规模集群应用分布在数台甚至成百上千台不同的服务器上，而日志又是我们开发人员用于定位问题、监控系统健康度、用于报警的最基础的数据来源。要想快速方便的对日志进行查找、分析归纳、归档、报警等功能，使用传统的 Linux 命令去查看日志，肯定不现实。所以一般的分布式集群系统环境下，我们都会去构建一个集中的日志系统，可以将各个服务日志收集起来。从而达到我们需要的的效果。
业务规模复杂导致构建分布式日志系统的难点:
导致的日志多节点、日志量也在爆炸式的增长; 日志格式的不规范与不确定性; 日志的形式的复杂化(物理机/虚拟机、K8S、Docker，Application 等等),容器的标准输出，容器内文件、容器事件、K8S事件等等; 环境复杂、在K8S环境下的，机器宕机、上下线、POD销毁、扩容缩容引起的日志的更改，都需要瞬时的收集起来; 日志的种类多（Nginx 、CDN、Ingress、ServiceMesh Pod等等日志，审计日志、应用日志、中间件日志、调用链日志、网络日志等等） &mldr;&mldr; 日志的特点:
大量的数据, 流式数据； 上述的步骤，应该要解耦 要具体扩展性，数据量增加的时候，支持水平扩展。 开源的日志系统 我们要构建一个企业级的日志系统的，一般选择的有免费的和收费的，收费的，云厂商的日志服务，我们今天不在考虑范围内。免费的开源的主要有：
ELK stack GrayLog Loki 日志的产生到使用，主要经过下面的阶段： 采集 -> 传输 -> 缓冲 -> 处理 -> 存储 -> 检索
ELK stack ELK stack 是由 Elasticsearch、Logstash、Kibana 开源组件集合分析、搜索、展示的日志系统解决方案。
Elatsicsearch 是全文搜索分析引擎 Logstash 日志聚合器，收集和处理多种数据源的数据、转换并发送到其他目的地 Kibana 用户界面，用于可视化的查询分析数据 Beats 用于数据收集数据 GrayLog GrayLog 也是一款开源的日志解决方案，本身 Graylog 提供了日志收集、日志存储搭配 MongoDB，查询层面依赖 Elasticsearch, Github 地址 github
Graylog 提供对外接口，Web页面 Elasticsearcg 日志文件的持久化存储和检索 MongoDB 存储 Graylog 的配置 Graylog 一体化方案、方便、但是没有分层。因为不是 agent 方式，其支持的日志收集方式有 RestApi、UDP、TCP。 整体来说，通过构建 Input 来收集日志，每个 Input 可以单独配置 Extractors 来做字段转换。 当然还有其他的概念，诸如"><meta property="og:type" content="article"><meta property="og:url" content="https://pinkhello.cc/posts/%E5%88%86%E5%B8%83%E5%BC%8F%E7%B3%BB%E7%BB%9F%E4%B8%8B%E7%9A%84%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86%E5%88%86%E6%9E%90%E6%96%B9%E6%A1%88/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-09-08T15:03:20+08:00"><meta property="article:modified_time" content="2022-09-08T15:03:20+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="分布式系统下的日志收集分析方案"><meta name=twitter:description content="前言 分布式系统下，大规模集群应用分布在数台甚至成百上千台不同的服务器上，而日志又是我们开发人员用于定位问题、监控系统健康度、用于报警的最基础的数据来源。要想快速方便的对日志进行查找、分析归纳、归档、报警等功能，使用传统的 Linux 命令去查看日志，肯定不现实。所以一般的分布式集群系统环境下，我们都会去构建一个集中的日志系统，可以将各个服务日志收集起来。从而达到我们需要的的效果。
业务规模复杂导致构建分布式日志系统的难点:
导致的日志多节点、日志量也在爆炸式的增长; 日志格式的不规范与不确定性; 日志的形式的复杂化(物理机/虚拟机、K8S、Docker，Application 等等),容器的标准输出，容器内文件、容器事件、K8S事件等等; 环境复杂、在K8S环境下的，机器宕机、上下线、POD销毁、扩容缩容引起的日志的更改，都需要瞬时的收集起来; 日志的种类多（Nginx 、CDN、Ingress、ServiceMesh Pod等等日志，审计日志、应用日志、中间件日志、调用链日志、网络日志等等） &mldr;&mldr; 日志的特点:
大量的数据, 流式数据； 上述的步骤，应该要解耦 要具体扩展性，数据量增加的时候，支持水平扩展。 开源的日志系统 我们要构建一个企业级的日志系统的，一般选择的有免费的和收费的，收费的，云厂商的日志服务，我们今天不在考虑范围内。免费的开源的主要有：
ELK stack GrayLog Loki 日志的产生到使用，主要经过下面的阶段： 采集 -> 传输 -> 缓冲 -> 处理 -> 存储 -> 检索
ELK stack ELK stack 是由 Elasticsearch、Logstash、Kibana 开源组件集合分析、搜索、展示的日志系统解决方案。
Elatsicsearch 是全文搜索分析引擎 Logstash 日志聚合器，收集和处理多种数据源的数据、转换并发送到其他目的地 Kibana 用户界面，用于可视化的查询分析数据 Beats 用于数据收集数据 GrayLog GrayLog 也是一款开源的日志解决方案，本身 Graylog 提供了日志收集、日志存储搭配 MongoDB，查询层面依赖 Elasticsearch, Github 地址 github
Graylog 提供对外接口，Web页面 Elasticsearcg 日志文件的持久化存储和检索 MongoDB 存储 Graylog 的配置 Graylog 一体化方案、方便、但是没有分层。因为不是 agent 方式，其支持的日志收集方式有 RestApi、UDP、TCP。 整体来说，通过构建 Input 来收集日志，每个 Input 可以单独配置 Extractors 来做字段转换。 当然还有其他的概念，诸如"><link rel=stylesheet href=https://pinkhello.cc/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><link rel=stylesheet href=https://pinkhello.cc/css/pinkhello.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://pinkhello.cc/images/favicon.ico><script>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-M2FXWC325L","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://pinkhello.cc/posts/60-redis/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://pinkhello.cc/posts/62-%E8%A1%A8%E9%A9%B1%E5%8A%A8%E7%BC%96%E7%A8%8B/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&text=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&title=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&is_video=false&description=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&title=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&title=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&name=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88&description=%e5%89%8d%e8%a8%80%20%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%ef%bc%8c%e5%a4%a7%e8%a7%84%e6%a8%a1%e9%9b%86%e7%be%a4%e5%ba%94%e7%94%a8%e5%88%86%e5%b8%83%e5%9c%a8%e6%95%b0%e5%8f%b0%e7%94%9a%e8%87%b3%e6%88%90%e7%99%be%e4%b8%8a%e5%8d%83%e5%8f%b0%e4%b8%8d%e5%90%8c%e7%9a%84%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%ef%bc%8c%e8%80%8c%e6%97%a5%e5%bf%97%e5%8f%88%e6%98%af%e6%88%91%e4%bb%ac%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e7%94%a8%e4%ba%8e%e5%ae%9a%e4%bd%8d%e9%97%ae%e9%a2%98%e3%80%81%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%e5%81%a5%e5%ba%b7%e5%ba%a6%e3%80%81%e7%94%a8%e4%ba%8e%e6%8a%a5%e8%ad%a6%e7%9a%84%e6%9c%80%e5%9f%ba%e7%a1%80%e7%9a%84%e6%95%b0%e6%8d%ae%e6%9d%a5%e6%ba%90%e3%80%82%e8%a6%81%e6%83%b3%e5%bf%ab%e9%80%9f%e6%96%b9%e4%be%bf%e7%9a%84%e5%af%b9%e6%97%a5%e5%bf%97%e8%bf%9b%e8%a1%8c%e6%9f%a5%e6%89%be%e3%80%81%e5%88%86%e6%9e%90%e5%bd%92%e7%ba%b3%e3%80%81%e5%bd%92%e6%a1%a3%e3%80%81%e6%8a%a5%e8%ad%a6%e7%ad%89%e5%8a%9f%e8%83%bd%ef%bc%8c%e4%bd%bf%e7%94%a8%e4%bc%a0%e7%bb%9f%e7%9a%84%20Linux%20%e5%91%bd%e4%bb%a4%e5%8e%bb%e6%9f%a5%e7%9c%8b%e6%97%a5%e5%bf%97%ef%bc%8c%e8%82%af%e5%ae%9a%e4%b8%8d%e7%8e%b0%e5%ae%9e%e3%80%82%e6%89%80%e4%bb%a5%e4%b8%80%e8%88%ac%e7%9a%84%e5%88%86%e5%b8%83%e5%bc%8f%e9%9b%86%e7%be%a4%e7%b3%bb%e7%bb%9f%e7%8e%af%e5%a2%83%e4%b8%8b%ef%bc%8c%e6%88%91%e4%bb%ac%e9%83%bd%e4%bc%9a%e5%8e%bb%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e9%9b%86%e4%b8%ad%e7%9a%84%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%b0%86%e5%90%84%e4%b8%aa%e6%9c%8d%e5%8a%a1%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e8%b5%b7%e6%9d%a5%e3%80%82%e4%bb%8e%e8%80%8c%e8%be%be%e5%88%b0%e6%88%91%e4%bb%ac%e9%9c%80%e8%a6%81%e7%9a%84%e7%9a%84%e6%95%88%e6%9e%9c%e3%80%82%0a%e4%b8%9a%e5%8a%a1%e8%a7%84%e6%a8%a1%e5%a4%8d%e6%9d%82%e5%af%bc%e8%87%b4%e6%9e%84%e5%bb%ba%e5%88%86%e5%b8%83%e5%bc%8f%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%e7%9a%84%e9%9a%be%e7%82%b9%3a%0a%e5%af%bc%e8%87%b4%e7%9a%84%e6%97%a5%e5%bf%97%e5%a4%9a%e8%8a%82%e7%82%b9%e3%80%81%e6%97%a5%e5%bf%97%e9%87%8f%e4%b9%9f%e5%9c%a8%e7%88%86%e7%82%b8%e5%bc%8f%e7%9a%84%e5%a2%9e%e9%95%bf%3b%20%e6%97%a5%e5%bf%97%e6%a0%bc%e5%bc%8f%e7%9a%84%e4%b8%8d%e8%a7%84%e8%8c%83%e4%b8%8e%e4%b8%8d%e7%a1%ae%e5%ae%9a%e6%80%a7%3b%20%e6%97%a5%e5%bf%97%e7%9a%84%e5%bd%a2%e5%bc%8f%e7%9a%84%e5%a4%8d%e6%9d%82%e5%8c%96%28%e7%89%a9%e7%90%86%e6%9c%ba%2f%e8%99%9a%e6%8b%9f%e6%9c%ba%e3%80%81K8S%e3%80%81Docker%ef%bc%8cApplication%20%e7%ad%89%e7%ad%89%29%2c%e5%ae%b9%e5%99%a8%e7%9a%84%e6%a0%87%e5%87%86%e8%be%93%e5%87%ba%ef%bc%8c%e5%ae%b9%e5%99%a8%e5%86%85%e6%96%87%e4%bb%b6%e3%80%81%e5%ae%b9%e5%99%a8%e4%ba%8b%e4%bb%b6%e3%80%81K8S%e4%ba%8b%e4%bb%b6%e7%ad%89%e7%ad%89%3b%20%e7%8e%af%e5%a2%83%e5%a4%8d%e6%9d%82%e3%80%81%e5%9c%a8K8S%e7%8e%af%e5%a2%83%e4%b8%8b%e7%9a%84%ef%bc%8c%e6%9c%ba%e5%99%a8%e5%ae%95%e6%9c%ba%e3%80%81%e4%b8%8a%e4%b8%8b%e7%ba%bf%e3%80%81POD%e9%94%80%e6%af%81%e3%80%81%e6%89%a9%e5%ae%b9%e7%bc%a9%e5%ae%b9%e5%bc%95%e8%b5%b7%e7%9a%84%e6%97%a5%e5%bf%97%e7%9a%84%e6%9b%b4%e6%94%b9%ef%bc%8c%e9%83%bd%e9%9c%80%e8%a6%81%e7%9e%ac%e6%97%b6%e7%9a%84%e6%94%b6%e9%9b%86%e8%b5%b7%e6%9d%a5%3b%20%e6%97%a5%e5%bf%97%e7%9a%84%e7%a7%8d%e7%b1%bb%e5%a4%9a%ef%bc%88Nginx%20%e3%80%81CDN%e3%80%81Ingress%e3%80%81ServiceMesh%20Pod%e7%ad%89%e7%ad%89%e6%97%a5%e5%bf%97%ef%bc%8c%e5%ae%a1%e8%ae%a1%e6%97%a5%e5%bf%97%e3%80%81%e5%ba%94%e7%94%a8%e6%97%a5%e5%bf%97%e3%80%81%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%97%a5%e5%bf%97%e3%80%81%e8%b0%83%e7%94%a8%e9%93%be%e6%97%a5%e5%bf%97%e3%80%81%e7%bd%91%e7%bb%9c%e6%97%a5%e5%bf%97%e7%ad%89%e7%ad%89%ef%bc%89%20%26hellip%3b%26hellip%3b%20%e6%97%a5%e5%bf%97%e7%9a%84%e7%89%b9%e7%82%b9%3a%0a%e5%a4%a7%e9%87%8f%e7%9a%84%e6%95%b0%e6%8d%ae%2c%20%e6%b5%81%e5%bc%8f%e6%95%b0%e6%8d%ae%ef%bc%9b%20%e4%b8%8a%e8%bf%b0%e7%9a%84%e6%ad%a5%e9%aa%a4%ef%bc%8c%e5%ba%94%e8%af%a5%e8%a6%81%e8%a7%a3%e8%80%a6%20%e8%a6%81%e5%85%b7%e4%bd%93%e6%89%a9%e5%b1%95%e6%80%a7%ef%bc%8c%e6%95%b0%e6%8d%ae%e9%87%8f%e5%a2%9e%e5%8a%a0%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%94%af%e6%8c%81%e6%b0%b4%e5%b9%b3%e6%89%a9%e5%b1%95%e3%80%82%20%e5%bc%80%e6%ba%90%e7%9a%84%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%20%e6%88%91%e4%bb%ac%e8%a6%81%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e4%bc%81%e4%b8%9a%e7%ba%a7%e7%9a%84%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%e7%9a%84%ef%bc%8c%e4%b8%80%e8%88%ac%e9%80%89%e6%8b%a9%e7%9a%84%e6%9c%89%e5%85%8d%e8%b4%b9%e7%9a%84%e5%92%8c%e6%94%b6%e8%b4%b9%e7%9a%84%ef%bc%8c%e6%94%b6%e8%b4%b9%e7%9a%84%ef%bc%8c%e4%ba%91%e5%8e%82%e5%95%86%e7%9a%84%e6%97%a5%e5%bf%97%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%88%91%e4%bb%ac%e4%bb%8a%e5%a4%a9%e4%b8%8d%e5%9c%a8%e8%80%83%e8%99%91%e8%8c%83%e5%9b%b4%e5%86%85%e3%80%82%e5%85%8d%e8%b4%b9%e7%9a%84%e5%bc%80%e6%ba%90%e7%9a%84%e4%b8%bb%e8%a6%81%e6%9c%89%ef%bc%9a%0aELK%20stack%20GrayLog%20Loki%20%e6%97%a5%e5%bf%97%e7%9a%84%e4%ba%a7%e7%94%9f%e5%88%b0%e4%bd%bf%e7%94%a8%ef%bc%8c%e4%b8%bb%e8%a6%81%e7%bb%8f%e8%bf%87%e4%b8%8b%e9%9d%a2%e7%9a%84%e9%98%b6%e6%ae%b5%ef%bc%9a%20%e9%87%87%e9%9b%86%20-%26gt%3b%20%e4%bc%a0%e8%be%93%20-%26gt%3b%20%e7%bc%93%e5%86%b2%20-%26gt%3b%20%e5%a4%84%e7%90%86%20-%26gt%3b%20%e5%ad%98%e5%82%a8%20-%26gt%3b%20%e6%a3%80%e7%b4%a2%0aELK%20stack%20ELK%20stack%20%e6%98%af%e7%94%b1%20Elasticsearch%e3%80%81Logstash%e3%80%81Kibana%20%e5%bc%80%e6%ba%90%e7%bb%84%e4%bb%b6%e9%9b%86%e5%90%88%e5%88%86%e6%9e%90%e3%80%81%e6%90%9c%e7%b4%a2%e3%80%81%e5%b1%95%e7%a4%ba%e7%9a%84%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88%e3%80%82%0aElatsicsearch%20%e6%98%af%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%88%86%e6%9e%90%e5%bc%95%e6%93%8e%20Logstash%20%e6%97%a5%e5%bf%97%e8%81%9a%e5%90%88%e5%99%a8%ef%bc%8c%e6%94%b6%e9%9b%86%e5%92%8c%e5%a4%84%e7%90%86%e5%a4%9a%e7%a7%8d%e6%95%b0%e6%8d%ae%e6%ba%90%e7%9a%84%e6%95%b0%e6%8d%ae%e3%80%81%e8%bd%ac%e6%8d%a2%e5%b9%b6%e5%8f%91%e9%80%81%e5%88%b0%e5%85%b6%e4%bb%96%e7%9b%ae%e7%9a%84%e5%9c%b0%20Kibana%20%e7%94%a8%e6%88%b7%e7%95%8c%e9%9d%a2%ef%bc%8c%e7%94%a8%e4%ba%8e%e5%8f%af%e8%a7%86%e5%8c%96%e7%9a%84%e6%9f%a5%e8%af%a2%e5%88%86%e6%9e%90%e6%95%b0%e6%8d%ae%20Beats%20%e7%94%a8%e4%ba%8e%e6%95%b0%e6%8d%ae%e6%94%b6%e9%9b%86%e6%95%b0%e6%8d%ae%20GrayLog%20GrayLog%20%e4%b9%9f%e6%98%af%e4%b8%80%e6%ac%be%e5%bc%80%e6%ba%90%e7%9a%84%e6%97%a5%e5%bf%97%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88%ef%bc%8c%e6%9c%ac%e8%ba%ab%20Graylog%20%e6%8f%90%e4%be%9b%e4%ba%86%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e3%80%81%e6%97%a5%e5%bf%97%e5%ad%98%e5%82%a8%e6%90%ad%e9%85%8d%20MongoDB%ef%bc%8c%e6%9f%a5%e8%af%a2%e5%b1%82%e9%9d%a2%e4%be%9d%e8%b5%96%20Elasticsearch%2c%20Github%20%e5%9c%b0%e5%9d%80%20github%0aGraylog%20%e6%8f%90%e4%be%9b%e5%af%b9%e5%a4%96%e6%8e%a5%e5%8f%a3%ef%bc%8cWeb%e9%a1%b5%e9%9d%a2%20Elasticsearcg%20%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6%e7%9a%84%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e5%92%8c%e6%a3%80%e7%b4%a2%20MongoDB%20%e5%ad%98%e5%82%a8%20Graylog%20%e7%9a%84%e9%85%8d%e7%bd%ae%20Graylog%20%e4%b8%80%e4%bd%93%e5%8c%96%e6%96%b9%e6%a1%88%e3%80%81%e6%96%b9%e4%be%bf%e3%80%81%e4%bd%86%e6%98%af%e6%b2%a1%e6%9c%89%e5%88%86%e5%b1%82%e3%80%82%e5%9b%a0%e4%b8%ba%e4%b8%8d%e6%98%af%20agent%20%e6%96%b9%e5%bc%8f%ef%bc%8c%e5%85%b6%e6%94%af%e6%8c%81%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e6%96%b9%e5%bc%8f%e6%9c%89%20RestApi%e3%80%81UDP%e3%80%81TCP%e3%80%82%20%e6%95%b4%e4%bd%93%e6%9d%a5%e8%af%b4%ef%bc%8c%e9%80%9a%e8%bf%87%e6%9e%84%e5%bb%ba%20Input%20%e6%9d%a5%e6%94%b6%e9%9b%86%e6%97%a5%e5%bf%97%ef%bc%8c%e6%af%8f%e4%b8%aa%20Input%20%e5%8f%af%e4%bb%a5%e5%8d%95%e7%8b%ac%e9%85%8d%e7%bd%ae%20Extractors%20%e6%9d%a5%e5%81%9a%e5%ad%97%e6%ae%b5%e8%bd%ac%e6%8d%a2%e3%80%82%20%e5%bd%93%e7%84%b6%e8%bf%98%e6%9c%89%e5%85%b6%e4%bb%96%e7%9a%84%e6%a6%82%e5%bf%b5%ef%bc%8c%e8%af%b8%e5%a6%82" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&t=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">分布式系统下的日志收集分析方案</h1><div class=meta><div class=postdate><time datetime="2022-09-08 15:03:20 +0800 +0800" itemprop=datePublished>2022-09-08</time></div></div></header><div id=toc><nav id=TableOfContents><ul><li><a href=#elk-stack>ELK stack</a></li><li><a href=#graylog>GrayLog</a></li><li><a href=#loki>Loki</a></li><li><a href=#在-k8s-环境下的日志收集>在 K8S 环境下的日志收集</a></li></ul></nav></div><div class=content itemprop=articleBody><h1 id=前言>前言</h1><p>分布式系统下，大规模集群应用分布在数台甚至成百上千台不同的服务器上，而日志又是我们开发人员用于定位问题、监控系统健康度、用于报警的最基础的数据来源。要想快速方便的对日志进行查找、分析归纳、归档、报警等功能，使用传统的 Linux 命令去查看日志，肯定不现实。所以一般的分布式集群系统环境下，我们都会去构建一个集中的日志系统，可以将各个服务日志收集起来。从而达到我们需要的的效果。</p><p>业务规模复杂导致构建分布式日志系统的难点:</p><ul><li>导致的日志多节点、日志量也在爆炸式的增长;</li><li>日志格式的不规范与不确定性;</li><li>日志的形式的复杂化(物理机/虚拟机、K8S、Docker，Application 等等),容器的标准输出，容器内文件、容器事件、K8S事件等等;</li><li>环境复杂、在K8S环境下的，机器宕机、上下线、POD销毁、扩容缩容引起的日志的更改，都需要瞬时的收集起来;</li><li>日志的种类多（Nginx 、CDN、Ingress、ServiceMesh Pod等等日志，审计日志、应用日志、中间件日志、调用链日志、网络日志等等）</li><li>&mldr;&mldr;</li></ul><p>日志的特点:</p><ul><li>大量的数据, 流式数据；</li><li>上述的步骤，应该要解耦</li><li>要具体扩展性，数据量增加的时候，支持水平扩展。</li></ul><h1 id=开源的日志系统>开源的日志系统</h1><p>我们要构建一个企业级的日志系统的，一般选择的有免费的和收费的，收费的，云厂商的日志服务，我们今天不在考虑范围内。免费的开源的主要有：</p><ul><li><a href=https://www.elastic.co/cn/elastic-stack/>ELK stack</a></li><li><a href=https://www.graylog.org/>GrayLog</a></li><li><a href=https://grafana.com/oss/loki/>Loki</a></li></ul><p>日志的产生到使用，主要经过下面的阶段： 采集 -> 传输 -> 缓冲 -> 处理 -> 存储 -> 检索</p><h2 id=elk-stack>ELK stack</h2><p>ELK stack 是由 Elasticsearch、Logstash、Kibana 开源组件集合分析、搜索、展示的日志系统解决方案。</p><ul><li>Elatsicsearch 是全文搜索分析引擎</li><li>Logstash 日志聚合器，收集和处理多种数据源的数据、转换并发送到其他目的地</li><li>Kibana 用户界面，用于可视化的查询分析数据</li><li>Beats 用于数据收集数据</li></ul><h2 id=graylog>GrayLog</h2><p><a href=https://www.graylog.org/>GrayLog</a> 也是一款开源的日志解决方案，本身 Graylog 提供了日志收集、日志存储搭配 MongoDB，查询层面依赖 Elasticsearch, Github 地址 <a href=https://github.com/Graylog2/graylog2-server>github</a></p><ul><li>Graylog 提供对外接口，Web页面</li><li>Elasticsearcg 日志文件的持久化存储和检索</li><li>MongoDB 存储 Graylog 的配置</li></ul><p>Graylog 一体化方案、方便、但是没有分层。因为不是 agent 方式，其支持的日志收集方式有 RestApi、UDP、TCP。
整体来说，通过构建 Input 来收集日志，每个 Input 可以单独配置 Extractors 来做字段转换。
当然还有其他的概念，诸如</p><ul><li>Inputs 日志抓取接收、由 Sidecar 主动抓取、或者其他服务主动上报的</li><li>Extractors 日志数据格式解析转换， json解析、kv解析、时间戳解析、正则解析</li><li>Streams 日志分类分组，将日志分类条件并发生到不同的索引文件中</li><li>Indices 持久化存储，数据存储性能</li><li>Outputs 日志数据转发，解析的 Stream 发送到其他的 Graylog 集群或服务</li><li>Pipelines 日志数据过滤，建立数据清洗过滤规则、字段的添加删除、条件过滤、自定义函数等</li><li>Sidecar 轻量级的日志采集器，适合大规模的适合使用</li><li>Lookup Tables 服务解析，基于 IP 的 whois 查询 和 基于 来源IP 的监控</li><li>Geolocation 可视化地理位置，基于 来源IP 的监控</li></ul><h2 id=loki>Loki</h2><p><a href=https://grafana.com/oss/loki/>Loki</a> 是一个日志聚合系统，旨在纯纯和查询来自所有的应用程序和基础架构的日志。它与 prometheus 一样是可扩展、高可用、多租户的日志聚合系统，它不索引日志内容，只是为每个日志设置标签。</p><ul><li>很简便</li><li>对象存储</li><li>结合 alert manager 生成报警</li><li>与 Prometheus、Grafana、K8S 原生集成</li><li>实时查看日志</li></ul><p>一个简单的使用 Loki 的组件，日志系统包含了几个</p><ul><li>promtail 客户端，抓取日志，通过网关推送给 Loki</li><li>Minio 用于存储数据</li><li>Grafana 提供 Loki 捕获的日志行的可视化</li><li>&mldr;</li></ul><p><img src=/logs/loki.png alt=Loki></p><p><a href=https://grafana.com/docs/loki/latest/best-practices/>Loki 最佳实践</a></p><ul><li>静态标签支持的更好，标签应该具有有限的值。并且在查询日志的适合更有效与快速</li><li>谨慎使用动态标签，太多的标签会导致太多的流，这种会降低性能。在确实需要的时候，应该使用 过滤器 去查询</li><li>动态标签的化，请使用有界的值</li><li>使用 chunk_target_size 和 max_chunk_age 来合理控制区块大小 与 时间内区块数量</li><li>日志的时间顺序，当然 Loki 接受乱序的写入，但是针对一个日志，最好是顺序，否则后续的会使用新日志，如果是多个实例的，最好加上实例的host。 Promtail pipeline stage 可以从日志行提取时间，或者让 Promtail 为日志行分配时间戳</li></ul><p>Loki 的几个核心配置</p><ul><li>基本的配置</li><li>HTTP 和 GRPC</li><li>服务发现 支持 consul、etcd</li><li>存储支持Local、GCS、AZURE、Swift、BOS(百度对象存储)</li></ul><p>Loki支持客户端有哪些</p><ul><li>Promtail : Promtail是K8S首选，同一个节点的运行POD抓取日志。节点机器也可以使用 Promtail。</li><li>Docker Driver :</li><li>Fluentd 和 Fluent Bit : 当使用 Flentd 的时候，可以使用这个插件，选择 filter</li><li>Logstash : 如果是 Logstash 或 beats，直接添加输出插件。</li><li>Lambda Promtail : Loki 监控 AWS lambda 日志</li><li>非官方的 <a href=https://grafana.com/docs/loki/latest/clients/#unofficial-clients>Go、Java、C#、Js、Python3</a></li></ul><p>Loki 有一个可配置的存储模式 : 一个 from 标志着起点，在这个期间，该 schema都是活动状态，直到另一个条目具有了 新的 from 日期</p><p>WAL(Write Ahead Log)</p><p>Ingester 是将数据存在内存中，而 WAL机制可以弥补在发生奔溃的情况下导致的数据丢失的情况， WAL 是将数据存储在本地文件系统中，
重启的时候 Loki 将对数据进行 &ldquo;重放&rdquo;, 然后重放完毕后将自己注册为准备好了的，预备接收后续写入。一旦确认写入就不会丢失数据。</p><p>Loki 设计亮点</p><ul><li><a href=https://grafana.com/docs/loki/latest/design-documents/labels/>Labels</a></li><li><a href=https://grafana.com/docs/loki/latest/design-documents/2020-02-promtail-push-api/>Promtail Push API</a></li><li><a href=https://grafana.com/docs/loki/latest/design-documents/2020-09-write-ahead-log/>Write-Ahead Logs</a></li><li><a href=https://grafana.com/docs/loki/latest/design-documents/2021-01-ordering-constraint-removal/>Ordering Constraint Removal</a></li></ul><h2 id=在-k8s-环境下的日志收集>在 K8S 环境下的日志收集</h2><p>不管以选择哪种日志方案、或者商业化的日志收集方案，
先看要收集哪些日志</p><ul><li>系统 和 K8S 组件日志 <code>/var/log/..</code></li><li>业务应用程序日志 <code>自定义日志路径</code></li></ul><p>涉及到 K8S 的日志采集、主要有以下几种方式</p><ul><li>Node 级日志代理 : 在每个宿主机上一个日志收集agent, 减少资源消耗、对应用无侵入。但是对于一些定制化的支持的不够</li></ul><p><img src=/logs/nodeagent.png alt=Node级日志代理></p><ul><li>Sidecar Container 作为日志代理 : 伴生容器，和应用容器在一个POD下, 专门收集应用日志，通过共享卷获取日志上传，也带来了额外的资源消耗，增加运营成本。但是低耦合。</li></ul><p><img src=/logs/sidecar-agent.png alt=Sidecar日志代理></p><ul><li>App 级直接上传日志 : 无需额外收集器、但同时也侵入应用了，增加应用复杂度。</li></ul></div></article><div class=blog-post-comments><div id=disqus_thread><script type=text/javascript>(function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="pinkhello",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&text=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&title=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&is_video=false&description=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&title=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&title=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&name=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88&description=%e5%89%8d%e8%a8%80%20%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%ef%bc%8c%e5%a4%a7%e8%a7%84%e6%a8%a1%e9%9b%86%e7%be%a4%e5%ba%94%e7%94%a8%e5%88%86%e5%b8%83%e5%9c%a8%e6%95%b0%e5%8f%b0%e7%94%9a%e8%87%b3%e6%88%90%e7%99%be%e4%b8%8a%e5%8d%83%e5%8f%b0%e4%b8%8d%e5%90%8c%e7%9a%84%e6%9c%8d%e5%8a%a1%e5%99%a8%e4%b8%8a%ef%bc%8c%e8%80%8c%e6%97%a5%e5%bf%97%e5%8f%88%e6%98%af%e6%88%91%e4%bb%ac%e5%bc%80%e5%8f%91%e4%ba%ba%e5%91%98%e7%94%a8%e4%ba%8e%e5%ae%9a%e4%bd%8d%e9%97%ae%e9%a2%98%e3%80%81%e7%9b%91%e6%8e%a7%e7%b3%bb%e7%bb%9f%e5%81%a5%e5%ba%b7%e5%ba%a6%e3%80%81%e7%94%a8%e4%ba%8e%e6%8a%a5%e8%ad%a6%e7%9a%84%e6%9c%80%e5%9f%ba%e7%a1%80%e7%9a%84%e6%95%b0%e6%8d%ae%e6%9d%a5%e6%ba%90%e3%80%82%e8%a6%81%e6%83%b3%e5%bf%ab%e9%80%9f%e6%96%b9%e4%be%bf%e7%9a%84%e5%af%b9%e6%97%a5%e5%bf%97%e8%bf%9b%e8%a1%8c%e6%9f%a5%e6%89%be%e3%80%81%e5%88%86%e6%9e%90%e5%bd%92%e7%ba%b3%e3%80%81%e5%bd%92%e6%a1%a3%e3%80%81%e6%8a%a5%e8%ad%a6%e7%ad%89%e5%8a%9f%e8%83%bd%ef%bc%8c%e4%bd%bf%e7%94%a8%e4%bc%a0%e7%bb%9f%e7%9a%84%20Linux%20%e5%91%bd%e4%bb%a4%e5%8e%bb%e6%9f%a5%e7%9c%8b%e6%97%a5%e5%bf%97%ef%bc%8c%e8%82%af%e5%ae%9a%e4%b8%8d%e7%8e%b0%e5%ae%9e%e3%80%82%e6%89%80%e4%bb%a5%e4%b8%80%e8%88%ac%e7%9a%84%e5%88%86%e5%b8%83%e5%bc%8f%e9%9b%86%e7%be%a4%e7%b3%bb%e7%bb%9f%e7%8e%af%e5%a2%83%e4%b8%8b%ef%bc%8c%e6%88%91%e4%bb%ac%e9%83%bd%e4%bc%9a%e5%8e%bb%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e9%9b%86%e4%b8%ad%e7%9a%84%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%ef%bc%8c%e5%8f%af%e4%bb%a5%e5%b0%86%e5%90%84%e4%b8%aa%e6%9c%8d%e5%8a%a1%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e8%b5%b7%e6%9d%a5%e3%80%82%e4%bb%8e%e8%80%8c%e8%be%be%e5%88%b0%e6%88%91%e4%bb%ac%e9%9c%80%e8%a6%81%e7%9a%84%e7%9a%84%e6%95%88%e6%9e%9c%e3%80%82%0a%e4%b8%9a%e5%8a%a1%e8%a7%84%e6%a8%a1%e5%a4%8d%e6%9d%82%e5%af%bc%e8%87%b4%e6%9e%84%e5%bb%ba%e5%88%86%e5%b8%83%e5%bc%8f%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%e7%9a%84%e9%9a%be%e7%82%b9%3a%0a%e5%af%bc%e8%87%b4%e7%9a%84%e6%97%a5%e5%bf%97%e5%a4%9a%e8%8a%82%e7%82%b9%e3%80%81%e6%97%a5%e5%bf%97%e9%87%8f%e4%b9%9f%e5%9c%a8%e7%88%86%e7%82%b8%e5%bc%8f%e7%9a%84%e5%a2%9e%e9%95%bf%3b%20%e6%97%a5%e5%bf%97%e6%a0%bc%e5%bc%8f%e7%9a%84%e4%b8%8d%e8%a7%84%e8%8c%83%e4%b8%8e%e4%b8%8d%e7%a1%ae%e5%ae%9a%e6%80%a7%3b%20%e6%97%a5%e5%bf%97%e7%9a%84%e5%bd%a2%e5%bc%8f%e7%9a%84%e5%a4%8d%e6%9d%82%e5%8c%96%28%e7%89%a9%e7%90%86%e6%9c%ba%2f%e8%99%9a%e6%8b%9f%e6%9c%ba%e3%80%81K8S%e3%80%81Docker%ef%bc%8cApplication%20%e7%ad%89%e7%ad%89%29%2c%e5%ae%b9%e5%99%a8%e7%9a%84%e6%a0%87%e5%87%86%e8%be%93%e5%87%ba%ef%bc%8c%e5%ae%b9%e5%99%a8%e5%86%85%e6%96%87%e4%bb%b6%e3%80%81%e5%ae%b9%e5%99%a8%e4%ba%8b%e4%bb%b6%e3%80%81K8S%e4%ba%8b%e4%bb%b6%e7%ad%89%e7%ad%89%3b%20%e7%8e%af%e5%a2%83%e5%a4%8d%e6%9d%82%e3%80%81%e5%9c%a8K8S%e7%8e%af%e5%a2%83%e4%b8%8b%e7%9a%84%ef%bc%8c%e6%9c%ba%e5%99%a8%e5%ae%95%e6%9c%ba%e3%80%81%e4%b8%8a%e4%b8%8b%e7%ba%bf%e3%80%81POD%e9%94%80%e6%af%81%e3%80%81%e6%89%a9%e5%ae%b9%e7%bc%a9%e5%ae%b9%e5%bc%95%e8%b5%b7%e7%9a%84%e6%97%a5%e5%bf%97%e7%9a%84%e6%9b%b4%e6%94%b9%ef%bc%8c%e9%83%bd%e9%9c%80%e8%a6%81%e7%9e%ac%e6%97%b6%e7%9a%84%e6%94%b6%e9%9b%86%e8%b5%b7%e6%9d%a5%3b%20%e6%97%a5%e5%bf%97%e7%9a%84%e7%a7%8d%e7%b1%bb%e5%a4%9a%ef%bc%88Nginx%20%e3%80%81CDN%e3%80%81Ingress%e3%80%81ServiceMesh%20Pod%e7%ad%89%e7%ad%89%e6%97%a5%e5%bf%97%ef%bc%8c%e5%ae%a1%e8%ae%a1%e6%97%a5%e5%bf%97%e3%80%81%e5%ba%94%e7%94%a8%e6%97%a5%e5%bf%97%e3%80%81%e4%b8%ad%e9%97%b4%e4%bb%b6%e6%97%a5%e5%bf%97%e3%80%81%e8%b0%83%e7%94%a8%e9%93%be%e6%97%a5%e5%bf%97%e3%80%81%e7%bd%91%e7%bb%9c%e6%97%a5%e5%bf%97%e7%ad%89%e7%ad%89%ef%bc%89%20%26hellip%3b%26hellip%3b%20%e6%97%a5%e5%bf%97%e7%9a%84%e7%89%b9%e7%82%b9%3a%0a%e5%a4%a7%e9%87%8f%e7%9a%84%e6%95%b0%e6%8d%ae%2c%20%e6%b5%81%e5%bc%8f%e6%95%b0%e6%8d%ae%ef%bc%9b%20%e4%b8%8a%e8%bf%b0%e7%9a%84%e6%ad%a5%e9%aa%a4%ef%bc%8c%e5%ba%94%e8%af%a5%e8%a6%81%e8%a7%a3%e8%80%a6%20%e8%a6%81%e5%85%b7%e4%bd%93%e6%89%a9%e5%b1%95%e6%80%a7%ef%bc%8c%e6%95%b0%e6%8d%ae%e9%87%8f%e5%a2%9e%e5%8a%a0%e7%9a%84%e6%97%b6%e5%80%99%ef%bc%8c%e6%94%af%e6%8c%81%e6%b0%b4%e5%b9%b3%e6%89%a9%e5%b1%95%e3%80%82%20%e5%bc%80%e6%ba%90%e7%9a%84%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%20%e6%88%91%e4%bb%ac%e8%a6%81%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e4%bc%81%e4%b8%9a%e7%ba%a7%e7%9a%84%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%e7%9a%84%ef%bc%8c%e4%b8%80%e8%88%ac%e9%80%89%e6%8b%a9%e7%9a%84%e6%9c%89%e5%85%8d%e8%b4%b9%e7%9a%84%e5%92%8c%e6%94%b6%e8%b4%b9%e7%9a%84%ef%bc%8c%e6%94%b6%e8%b4%b9%e7%9a%84%ef%bc%8c%e4%ba%91%e5%8e%82%e5%95%86%e7%9a%84%e6%97%a5%e5%bf%97%e6%9c%8d%e5%8a%a1%ef%bc%8c%e6%88%91%e4%bb%ac%e4%bb%8a%e5%a4%a9%e4%b8%8d%e5%9c%a8%e8%80%83%e8%99%91%e8%8c%83%e5%9b%b4%e5%86%85%e3%80%82%e5%85%8d%e8%b4%b9%e7%9a%84%e5%bc%80%e6%ba%90%e7%9a%84%e4%b8%bb%e8%a6%81%e6%9c%89%ef%bc%9a%0aELK%20stack%20GrayLog%20Loki%20%e6%97%a5%e5%bf%97%e7%9a%84%e4%ba%a7%e7%94%9f%e5%88%b0%e4%bd%bf%e7%94%a8%ef%bc%8c%e4%b8%bb%e8%a6%81%e7%bb%8f%e8%bf%87%e4%b8%8b%e9%9d%a2%e7%9a%84%e9%98%b6%e6%ae%b5%ef%bc%9a%20%e9%87%87%e9%9b%86%20-%26gt%3b%20%e4%bc%a0%e8%be%93%20-%26gt%3b%20%e7%bc%93%e5%86%b2%20-%26gt%3b%20%e5%a4%84%e7%90%86%20-%26gt%3b%20%e5%ad%98%e5%82%a8%20-%26gt%3b%20%e6%a3%80%e7%b4%a2%0aELK%20stack%20ELK%20stack%20%e6%98%af%e7%94%b1%20Elasticsearch%e3%80%81Logstash%e3%80%81Kibana%20%e5%bc%80%e6%ba%90%e7%bb%84%e4%bb%b6%e9%9b%86%e5%90%88%e5%88%86%e6%9e%90%e3%80%81%e6%90%9c%e7%b4%a2%e3%80%81%e5%b1%95%e7%a4%ba%e7%9a%84%e6%97%a5%e5%bf%97%e7%b3%bb%e7%bb%9f%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88%e3%80%82%0aElatsicsearch%20%e6%98%af%e5%85%a8%e6%96%87%e6%90%9c%e7%b4%a2%e5%88%86%e6%9e%90%e5%bc%95%e6%93%8e%20Logstash%20%e6%97%a5%e5%bf%97%e8%81%9a%e5%90%88%e5%99%a8%ef%bc%8c%e6%94%b6%e9%9b%86%e5%92%8c%e5%a4%84%e7%90%86%e5%a4%9a%e7%a7%8d%e6%95%b0%e6%8d%ae%e6%ba%90%e7%9a%84%e6%95%b0%e6%8d%ae%e3%80%81%e8%bd%ac%e6%8d%a2%e5%b9%b6%e5%8f%91%e9%80%81%e5%88%b0%e5%85%b6%e4%bb%96%e7%9b%ae%e7%9a%84%e5%9c%b0%20Kibana%20%e7%94%a8%e6%88%b7%e7%95%8c%e9%9d%a2%ef%bc%8c%e7%94%a8%e4%ba%8e%e5%8f%af%e8%a7%86%e5%8c%96%e7%9a%84%e6%9f%a5%e8%af%a2%e5%88%86%e6%9e%90%e6%95%b0%e6%8d%ae%20Beats%20%e7%94%a8%e4%ba%8e%e6%95%b0%e6%8d%ae%e6%94%b6%e9%9b%86%e6%95%b0%e6%8d%ae%20GrayLog%20GrayLog%20%e4%b9%9f%e6%98%af%e4%b8%80%e6%ac%be%e5%bc%80%e6%ba%90%e7%9a%84%e6%97%a5%e5%bf%97%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88%ef%bc%8c%e6%9c%ac%e8%ba%ab%20Graylog%20%e6%8f%90%e4%be%9b%e4%ba%86%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e3%80%81%e6%97%a5%e5%bf%97%e5%ad%98%e5%82%a8%e6%90%ad%e9%85%8d%20MongoDB%ef%bc%8c%e6%9f%a5%e8%af%a2%e5%b1%82%e9%9d%a2%e4%be%9d%e8%b5%96%20Elasticsearch%2c%20Github%20%e5%9c%b0%e5%9d%80%20github%0aGraylog%20%e6%8f%90%e4%be%9b%e5%af%b9%e5%a4%96%e6%8e%a5%e5%8f%a3%ef%bc%8cWeb%e9%a1%b5%e9%9d%a2%20Elasticsearcg%20%e6%97%a5%e5%bf%97%e6%96%87%e4%bb%b6%e7%9a%84%e6%8c%81%e4%b9%85%e5%8c%96%e5%ad%98%e5%82%a8%e5%92%8c%e6%a3%80%e7%b4%a2%20MongoDB%20%e5%ad%98%e5%82%a8%20Graylog%20%e7%9a%84%e9%85%8d%e7%bd%ae%20Graylog%20%e4%b8%80%e4%bd%93%e5%8c%96%e6%96%b9%e6%a1%88%e3%80%81%e6%96%b9%e4%be%bf%e3%80%81%e4%bd%86%e6%98%af%e6%b2%a1%e6%9c%89%e5%88%86%e5%b1%82%e3%80%82%e5%9b%a0%e4%b8%ba%e4%b8%8d%e6%98%af%20agent%20%e6%96%b9%e5%bc%8f%ef%bc%8c%e5%85%b6%e6%94%af%e6%8c%81%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e6%96%b9%e5%bc%8f%e6%9c%89%20RestApi%e3%80%81UDP%e3%80%81TCP%e3%80%82%20%e6%95%b4%e4%bd%93%e6%9d%a5%e8%af%b4%ef%bc%8c%e9%80%9a%e8%bf%87%e6%9e%84%e5%bb%ba%20Input%20%e6%9d%a5%e6%94%b6%e9%9b%86%e6%97%a5%e5%bf%97%ef%bc%8c%e6%af%8f%e4%b8%aa%20Input%20%e5%8f%af%e4%bb%a5%e5%8d%95%e7%8b%ac%e9%85%8d%e7%bd%ae%20Extractors%20%e6%9d%a5%e5%81%9a%e5%ad%97%e6%ae%b5%e8%bd%ac%e6%8d%a2%e3%80%82%20%e5%bd%93%e7%84%b6%e8%bf%98%e6%9c%89%e5%85%b6%e4%bb%96%e7%9a%84%e6%a6%82%e5%bf%b5%ef%bc%8c%e8%af%b8%e5%a6%82" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2f%25E5%2588%2586%25E5%25B8%2583%25E5%25BC%258F%25E7%25B3%25BB%25E7%25BB%259F%25E4%25B8%258B%25E7%259A%2584%25E6%2597%25A5%25E5%25BF%2597%25E6%2594%25B6%25E9%259B%2586%25E5%2588%2586%25E6%259E%2590%25E6%2596%25B9%25E6%25A1%2588%2f&t=%e5%88%86%e5%b8%83%e5%bc%8f%e7%b3%bb%e7%bb%9f%e4%b8%8b%e7%9a%84%e6%97%a5%e5%bf%97%e6%94%b6%e9%9b%86%e5%88%86%e6%9e%90%e6%96%b9%e6%a1%88" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2023 pinkhello</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script><script src=/js/code-copy.js></script><script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>