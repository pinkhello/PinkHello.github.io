<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Golang的池化设计 | pinkhello</title><link rel=canonical href=https://pinkhello.cc/posts/43-golang%E7%9A%84%E6%B1%A0%E5%8C%96%E8%AE%BE%E8%AE%A1/><meta name=description content="👷Hey! 我是 **pinkhello**，💻 一名后端程序员。**重要提示**: 在您阅读文章并评论之前，请先认真阅读[**评论承诺**](http://pinkhello.cc/promise)。"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Golang的池化设计"><meta property="og:description" content="Why Pool？ 先埋坑: Go 有没有池化的必要? 为什么要池化? Go 自从出生以来都被我们冠以&#34;高并发&#34;的Tag, 回头细想和深究一下，你会发现其实都是由 goroutine 实现的 , 我们都知道 与 Thread 相比， 创建 Goroutine 的代价非常小。从程序表现上，也像极了Thread, 每个 Program 至少包含一个 Goroutine(至少一个**Main Goroutine**) 所有的其他 Goroutines 都依附于 Main Goroutine（如果 Main Goroutine Terminated, 其他 Goroutines 也会 Terminated）, Goroutine 总是工作在后台。
多线程``多进程是为了提高系统的并发能力，当前系统下，这边就需要系统调度，一个线程可以拆分为 &#34;用户态&#34;线程 和 &#34;内核态&#34;线程，这两者需要进行绑定，我们一般称 内核态线程 为线程，用户态线程为协程
从上面可以看出 协程 和 线程 有映射关系，这样就来了 M:N 关系(为什么不是 1:1, N:1 ? )
Goroutine 优点:
相比 Thread 代价更小 Goroutine 其在 stack 的大小可以根据程序要求进行变化，但是 Thread 是固定的 Goroutine 使用 Channel 进行通信，Channel 用于 Goroutines 访问共享内存的时候防止竞争的。 从程序上一个线程可能拥有许多的 Goroutines 关联，如果这些关联的 有一个 Goroutine 去阻塞了线程，那么剩余的 Goroutine 将分配给其他的 OS Thread，且这种切换操作是对开发者屏蔽的。 Goroutine 调度器 回头看将 Goroutine 和 协程 有区别的。调度"><meta property="og:type" content="article"><meta property="og:url" content="https://pinkhello.cc/posts/43-golang%E7%9A%84%E6%B1%A0%E5%8C%96%E8%AE%BE%E8%AE%A1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-02-02T02:52:28+08:00"><meta property="article:modified_time" content="2022-02-02T02:52:28+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Golang的池化设计"><meta name=twitter:description content="Why Pool？ 先埋坑: Go 有没有池化的必要? 为什么要池化? Go 自从出生以来都被我们冠以&#34;高并发&#34;的Tag, 回头细想和深究一下，你会发现其实都是由 goroutine 实现的 , 我们都知道 与 Thread 相比， 创建 Goroutine 的代价非常小。从程序表现上，也像极了Thread, 每个 Program 至少包含一个 Goroutine(至少一个**Main Goroutine**) 所有的其他 Goroutines 都依附于 Main Goroutine（如果 Main Goroutine Terminated, 其他 Goroutines 也会 Terminated）, Goroutine 总是工作在后台。
多线程``多进程是为了提高系统的并发能力，当前系统下，这边就需要系统调度，一个线程可以拆分为 &#34;用户态&#34;线程 和 &#34;内核态&#34;线程，这两者需要进行绑定，我们一般称 内核态线程 为线程，用户态线程为协程
从上面可以看出 协程 和 线程 有映射关系，这样就来了 M:N 关系(为什么不是 1:1, N:1 ? )
Goroutine 优点:
相比 Thread 代价更小 Goroutine 其在 stack 的大小可以根据程序要求进行变化，但是 Thread 是固定的 Goroutine 使用 Channel 进行通信，Channel 用于 Goroutines 访问共享内存的时候防止竞争的。 从程序上一个线程可能拥有许多的 Goroutines 关联，如果这些关联的 有一个 Goroutine 去阻塞了线程，那么剩余的 Goroutine 将分配给其他的 OS Thread，且这种切换操作是对开发者屏蔽的。 Goroutine 调度器 回头看将 Goroutine 和 协程 有区别的。调度"><link rel=stylesheet href=https://pinkhello.cc/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://pinkhello.cc/images/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-M2FXWC325L","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://pinkhello.cc/posts/40-mvcc%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%9A%84%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B9%8B%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://pinkhello.cc/posts/45-%E5%A6%82%E4%BD%95%E5%8E%BB%E5%AE%9E%E7%8E%B0ringbuffer/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&text=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&title=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&is_video=false&description=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&title=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&title=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&name=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1&description=Why%20Pool%ef%bc%9f%20%e5%85%88%e5%9f%8b%e5%9d%91%3a%20Go%20%e6%9c%89%e6%b2%a1%e6%9c%89%e6%b1%a0%e5%8c%96%e7%9a%84%e5%bf%85%e8%a6%81%3f%20%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e6%b1%a0%e5%8c%96%3f%20Go%20%e8%87%aa%e4%bb%8e%e5%87%ba%e7%94%9f%e4%bb%a5%e6%9d%a5%e9%83%bd%e8%a2%ab%e6%88%91%e4%bb%ac%e5%86%a0%e4%bb%a5%26quot%3b%e9%ab%98%e5%b9%b6%e5%8f%91%26quot%3b%e7%9a%84Tag%2c%20%e5%9b%9e%e5%a4%b4%e7%bb%86%e6%83%b3%e5%92%8c%e6%b7%b1%e7%a9%b6%e4%b8%80%e4%b8%8b%ef%bc%8c%e4%bd%a0%e4%bc%9a%e5%8f%91%e7%8e%b0%e5%85%b6%e5%ae%9e%e9%83%bd%e6%98%af%e7%94%b1%20goroutine%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20%2c%20%e6%88%91%e4%bb%ac%e9%83%bd%e7%9f%a5%e9%81%93%20%e4%b8%8e%20Thread%20%e7%9b%b8%e6%af%94%ef%bc%8c%20%e5%88%9b%e5%bb%ba%20Goroutine%20%e7%9a%84%e4%bb%a3%e4%bb%b7%e9%9d%9e%e5%b8%b8%e5%b0%8f%e3%80%82%e4%bb%8e%e7%a8%8b%e5%ba%8f%e8%a1%a8%e7%8e%b0%e4%b8%8a%ef%bc%8c%e4%b9%9f%e5%83%8f%e6%9e%81%e4%ba%86Thread%2c%20%e6%af%8f%e4%b8%aa%20Program%20%e8%87%b3%e5%b0%91%e5%8c%85%e5%90%ab%e4%b8%80%e4%b8%aa%20Goroutine%28%e8%87%b3%e5%b0%91%e4%b8%80%e4%b8%aa%2a%2aMain%20Goroutine%2a%2a%29%20%e6%89%80%e6%9c%89%e7%9a%84%e5%85%b6%e4%bb%96%20Goroutines%20%e9%83%bd%e4%be%9d%e9%99%84%e4%ba%8e%20Main%20Goroutine%ef%bc%88%e5%a6%82%e6%9e%9c%20Main%20Goroutine%20Terminated%2c%20%e5%85%b6%e4%bb%96%20Goroutines%20%e4%b9%9f%e4%bc%9a%20Terminated%ef%bc%89%2c%20Goroutine%20%e6%80%bb%e6%98%af%e5%b7%a5%e4%bd%9c%e5%9c%a8%e5%90%8e%e5%8f%b0%e3%80%82%0a%e5%a4%9a%e7%ba%bf%e7%a8%8b%60%60%e5%a4%9a%e8%bf%9b%e7%a8%8b%e6%98%af%e4%b8%ba%e4%ba%86%e6%8f%90%e9%ab%98%e7%b3%bb%e7%bb%9f%e7%9a%84%e5%b9%b6%e5%8f%91%e8%83%bd%e5%8a%9b%ef%bc%8c%e5%bd%93%e5%89%8d%e7%b3%bb%e7%bb%9f%e4%b8%8b%ef%bc%8c%e8%bf%99%e8%be%b9%e5%b0%b1%e9%9c%80%e8%a6%81%e7%b3%bb%e7%bb%9f%e8%b0%83%e5%ba%a6%ef%bc%8c%e4%b8%80%e4%b8%aa%e7%ba%bf%e7%a8%8b%e5%8f%af%e4%bb%a5%e6%8b%86%e5%88%86%e4%b8%ba%20%26quot%3b%e7%94%a8%e6%88%b7%e6%80%81%26quot%3b%e7%ba%bf%e7%a8%8b%20%e5%92%8c%20%26quot%3b%e5%86%85%e6%a0%b8%e6%80%81%26quot%3b%e7%ba%bf%e7%a8%8b%ef%bc%8c%e8%bf%99%e4%b8%a4%e8%80%85%e9%9c%80%e8%a6%81%e8%bf%9b%e8%a1%8c%e7%bb%91%e5%ae%9a%ef%bc%8c%e6%88%91%e4%bb%ac%e4%b8%80%e8%88%ac%e7%a7%b0%20%e5%86%85%e6%a0%b8%e6%80%81%e7%ba%bf%e7%a8%8b%20%e4%b8%ba%e7%ba%bf%e7%a8%8b%ef%bc%8c%e7%94%a8%e6%88%b7%e6%80%81%e7%ba%bf%e7%a8%8b%e4%b8%ba%e5%8d%8f%e7%a8%8b%0a%e4%bb%8e%e4%b8%8a%e9%9d%a2%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%87%ba%20%e5%8d%8f%e7%a8%8b%20%e5%92%8c%20%e7%ba%bf%e7%a8%8b%20%e6%9c%89%e6%98%a0%e5%b0%84%e5%85%b3%e7%b3%bb%ef%bc%8c%e8%bf%99%e6%a0%b7%e5%b0%b1%e6%9d%a5%e4%ba%86%20M%3aN%20%e5%85%b3%e7%b3%bb%28%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%8d%e6%98%af%201%3a1%2c%20N%3a1%20%3f%20%29%0aGoroutine%20%e4%bc%98%e7%82%b9%3a%0a%e7%9b%b8%e6%af%94%20Thread%20%e4%bb%a3%e4%bb%b7%e6%9b%b4%e5%b0%8f%20Goroutine%20%e5%85%b6%e5%9c%a8%20stack%20%e7%9a%84%e5%a4%a7%e5%b0%8f%e5%8f%af%e4%bb%a5%e6%a0%b9%e6%8d%ae%e7%a8%8b%e5%ba%8f%e8%a6%81%e6%b1%82%e8%bf%9b%e8%a1%8c%e5%8f%98%e5%8c%96%ef%bc%8c%e4%bd%86%e6%98%af%20Thread%20%e6%98%af%e5%9b%ba%e5%ae%9a%e7%9a%84%20Goroutine%20%e4%bd%bf%e7%94%a8%20Channel%20%e8%bf%9b%e8%a1%8c%e9%80%9a%e4%bf%a1%ef%bc%8cChannel%20%e7%94%a8%e4%ba%8e%20Goroutines%20%e8%ae%bf%e9%97%ae%e5%85%b1%e4%ba%ab%e5%86%85%e5%ad%98%e7%9a%84%e6%97%b6%e5%80%99%e9%98%b2%e6%ad%a2%e7%ab%9e%e4%ba%89%e7%9a%84%e3%80%82%20%e4%bb%8e%e7%a8%8b%e5%ba%8f%e4%b8%8a%e4%b8%80%e4%b8%aa%e7%ba%bf%e7%a8%8b%e5%8f%af%e8%83%bd%e6%8b%a5%e6%9c%89%e8%ae%b8%e5%a4%9a%e7%9a%84%20Goroutines%20%e5%85%b3%e8%81%94%ef%bc%8c%e5%a6%82%e6%9e%9c%e8%bf%99%e4%ba%9b%e5%85%b3%e8%81%94%e7%9a%84%20%e6%9c%89%e4%b8%80%e4%b8%aa%20Goroutine%20%e5%8e%bb%e9%98%bb%e5%a1%9e%e4%ba%86%e7%ba%bf%e7%a8%8b%ef%bc%8c%e9%82%a3%e4%b9%88%e5%89%a9%e4%bd%99%e7%9a%84%20Goroutine%20%e5%b0%86%e5%88%86%e9%85%8d%e7%bb%99%e5%85%b6%e4%bb%96%e7%9a%84%20OS%20Thread%ef%bc%8c%e4%b8%94%e8%bf%99%e7%a7%8d%e5%88%87%e6%8d%a2%e6%93%8d%e4%bd%9c%e6%98%af%e5%af%b9%e5%bc%80%e5%8f%91%e8%80%85%e5%b1%8f%e8%94%bd%e7%9a%84%e3%80%82%20Goroutine%20%e8%b0%83%e5%ba%a6%e5%99%a8%20%e5%9b%9e%e5%a4%b4%e7%9c%8b%e5%b0%86%20Goroutine%20%e5%92%8c%20%e5%8d%8f%e7%a8%8b%20%e6%9c%89%e5%8c%ba%e5%88%ab%e7%9a%84%e3%80%82%e8%b0%83%e5%ba%a6" aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&t=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Golang的池化设计</h1><div class=meta><div class=postdate><time datetime="2022-02-02 02:52:28 +0800 +0800" itemprop=datePublished>2022-02-02</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/tech>Tech</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/golang rel=tag>golang</a></div></div></header><div id=toc><nav id=TableOfContents><ul><li><a href=#先埋坑-go-有没有池化的必要-为什么要池化>先埋坑: Go 有没有池化的必要? 为什么要池化?</a></li><li><a href=#goroutine-调度器>Goroutine <em><code>调度器</code></em></a></li><li><a href=#go-func-的调度流程>Go func 的调度流程</a></li><li><a href=#总结论调>总结论调</a></li></ul></nav></div><div class=content itemprop=articleBody><h1 id=why-pool>Why Pool？</h1><h2 id=先埋坑-go-有没有池化的必要-为什么要池化>先埋坑: Go 有没有池化的必要? 为什么要池化?</h2><p><code>Go</code> 自从出生以来都被我们冠以"高并发"的<code>Tag</code>, 回头细想和深究一下，你会发现其实都是由 <a href="https://www.geeksforgeeks.org/goroutines-concurrency-in-golang/#:~:text=A%20Goroutine%20is%20a%20function,like%20a%20light%20weighted%20thread.">goroutine</a> 实现的 ,
我们都知道 与 <code>Thread</code> 相比， 创建 <code>Goroutine</code> 的代价非常小。从程序表现上，也像极了<code>Thread</code>, 每个 <code>Program</code> 至少包含一个 <code>Goroutine</code>(至少一个**<code>Main Goroutine</code>**)
所有的其他 <code>Goroutines</code> 都依附于 <code>Main Goroutine</code>（如果 <code>Main Goroutine Terminated</code>, 其他 <code>Goroutines</code> 也会 <code>Terminated</code>）, <code>Goroutine</code> 总是工作在后台。</p><p><code>多线程``多进程</code>是为了提高系统的并发能力，当前系统下，这边就需要系统调度，一个线程可以拆分为 <code>"用户态"线程</code> 和 <code>"内核态"线程</code>，这两者需要进行绑定，我们一般称 <code>内核态线程</code> 为<code>线程</code>，<code>用户态线程</code>为<code>协程</code></p><p><img src=/golang%E5%8D%8F%E7%A8%8B%E6%B1%A0%E5%8C%96%E6%8A%80%E6%9C%AF/%E7%BA%BF%E7%A8%8B-CPU-%E8%A7%86%E8%A7%92.png alt=线程-CPU-视角></p><p>从上面可以看出 <code>协程</code> 和 <code>线程</code> 有映射关系，这样就来了 <code>M:N</code> 关系(为什么不是 <code>1:1</code>, <code>N:1</code> ? )</p><p><img src=/golang%E5%8D%8F%E7%A8%8B%E6%B1%A0%E5%8C%96%E6%8A%80%E6%9C%AF/M-N%E8%B0%83%E5%BA%A6.png alt=M-N调度></p><p><code>Goroutine</code> 优点:</p><ul><li>相比 <code>Thread</code> 代价更小</li><li><code>Goroutine</code> 其在 <code>stack</code> 的大小可以根据程序要求进行变化，但是 <code>Thread</code> 是固定的</li><li><code>Goroutine</code> 使用 <code>Channel</code> 进行通信，<code>Channel</code> 用于 <code>Goroutines</code> 访问共享内存的时候防止竞争的。</li><li>从程序上一个线程可能拥有许多的 <code>Goroutines</code> 关联，如果这些关联的 有一个 <code>Goroutine</code> 去阻塞了线程，那么剩余的 <code>Goroutine</code> 将分配给其他的 <code>OS Thread</code>，且这种切换操作是对开发者屏蔽的。</li></ul><h2 id=goroutine-调度器>Goroutine <em><code>调度器</code></em></h2><p>回头看将 <code>Goroutine</code> 和 <code>协程</code> 有区别的。<strong>调度</strong></p><p>好了，那么 <code>Goroutine</code>是如何去调度的, 这个需要了解 <code>Golang协程</code>的 <code>G-P-M</code> 调度模型?
官方： <a href=https://docs.google.com/document/d/1ETuA2IOmnaQ4j81AtTGT40Y4_Jr6_IDASEKg0t0dBR8/edit#>https://docs.google.com/document/d/1ETuA2IOmnaQ4j81AtTGT40Y4_Jr6_IDASEKg0t0dBR8/edit#</a></p><p><code>Goroutine</code>的调度模型示意图:</p><ul><li>废弃的<code>Goroutine调度器</code><ul><li><img src=/golang%E5%8D%8F%E7%A8%8B%E6%B1%A0%E5%8C%96%E6%8A%80%E6%9C%AF/%E8%80%81%E7%9A%84Goroutine%E8%B0%83%E5%BA%A6%E5%99%A8.png alt=老的Goroutine调度器></li></ul></li><li><code>Goroutine调度器</code><ul><li><img src=/golang%E5%8D%8F%E7%A8%8B%E6%B1%A0%E5%8C%96%E6%8A%80%E6%9C%AF/%E6%96%B0%E7%9A%84Goroutine%E8%B0%83%E5%BA%A6%E5%99%A8.png alt=新的Goroutine调度器></li></ul></li></ul><p>从上图中可以看出</p><p><code>Goroutine调度器</code>将<code>可以运行的goroutine</code>分配到工作线程，
<code>M</code>: 代表 <code>Thread</code>
<code>P</code>: 代表 <code>Processor</code>
<code>G</code>: 代表 <code>Goroutine</code></p><ul><li>废弃的调度方式<ul><li><code>M</code> 要执行、返还<code>G</code>都必须访问<code>全局的G队列</code>（这个队列是加锁的，这就导致了<code>访问全局G队列</code>是通过<code>互斥锁</code>保证的。）</li><li>创建、销毁、调度<code>G</code>都需要每个<code>M</code>获取锁，形成了竞争</li><li>系统调度(<code>CPU</code>与<code>M</code>之间的切换)，导致频繁的线程阻塞、取消阻塞操作，增加开销</li></ul></li><li>新的调度方式<ul><li><code>Global Queue</code>存放等待运行的 <code>G</code></li><li><code>P Local Queue</code>同上，存放等待运行的<code>G</code>，不能超过<code>256</code>个， 在新建<code>G</code>的时候优先加入到<code>P Local Queue</code>，如果<code>Queue</code>已满，就移动<code>Local Queue</code>中的一半<code>G</code>到<code>Global Queue</code>。</li><li><code>P</code>, 所有的<code>P</code>都在程序启动的时候创建，并保存在数组中，最多<code>GOMAXPROCS</code>个</li><li><code>M</code>, 线程想运行任务必须获取到<code>P</code>,<code>P</code>才是<code>G</code>和<code>M</code>的离合器，从<code>P Local Queue</code>获取<code>G</code>，<code>P Local Queue</code>为空时候，<code>M</code>会尝试从<code>Global Queue</code>获取一批<code>G</code>放到<code>P Local Queue</code>，或者从其他的<code>P Local Queue</code>窃取<code>一半的G</code>放到自己的<code>P Local Queue</code>。</li><li><code>M</code>执行运行<code>G</code>，<code>G</code>执行后，<code>M</code>会<code>P</code>获取下一个<code>G</code>，不断的重复执行。</li></ul></li></ul><p>P.S.:</p><blockquote><p>关于<code>P</code>和<code>M</code>的关系</p><ul><li><code>P</code></li></ul><blockquote><ul><li><code>P</code>的数量(<code>$GOMAXPROCS</code>或<code>runtime</code>的<code>GOMAXPROCS()</code>）决定，在程序执行的任意时刻都只有<code>$GOMAXPROCS</code>在同时执行</li><li>在确定<code>P</code>的最大数量<code>n</code>后，运行时系统会根据这个数量创建<code>n</code>个<code>P</code></li></ul></blockquote><ul><li><code>M</code></li></ul><blockquote><ul><li><code>M</code>的数量<code>go</code>语言限制, 设置<code>M</code>的最大数量，当然这个默认值基本可以忽略（<code>10000</code>, 内核很难支持这么多）</li><li><code>runtime/debug</code>中的<code>SetMaxThreads</code>函数</li><li>一个<code>M</code>阻塞了，会创建新的<code>M</code></li><li>没有足够的<code>M</code>来关联<code>P</code>并运行其中可运行的<code>G</code>(<code>M</code>都阻塞了、<code>P</code>还有很多就绪等待的，就会寻找空闲的<code>M</code>，如果没有空闲的<code>M</code>，就会选择创建新的<code>M</code>)</li></ul></blockquote></blockquote><p>综上看 <code>Goroutine</code> 的调度器设计的考虑:</p><ul><li><code>复用线程</code>：避免频繁的创建、销毁线程。对线程复用<ul><li><code>work stealing</code> 机制: 当<code>P Local Queue</code>无可运行的<code>G</code>时候，尝试从其他线程绑定的的<code>P</code>的<code>P Local Queue</code>获取<code>G</code></li><li><code>hand off</code> 机制: 当<code>线程</code>因为<code>G</code>进行系统调用<code>阻塞</code>时候，线程释放绑定的<code>P</code>，把<code>P</code>转移给<code>其他空闲的线程</code>执行</li></ul></li><li><code>并行</code>：<code>GOMAXPROCS</code>设置<code>P</code>的数量，最多有<code>$GOMAXPROCS</code>个线程分布在<code>多个CPU</code>进行同时运行，<code>GOMAXPROCS</code>也限制了并发，假如<code>GOMAXPROCS</code>&lt;<code>CPU核数</code>，则最多用<code>GOMAXPROCS</code>个<code>CPU核</code>进行并行</li><li><code>Global Queue</code>，弱化了<code>Global Queue</code>的设计，当<code>M</code>执行<code>work stealing</code>从其他的<code>P</code>偷不到<code>G</code>时候，它可以从<code>Global Queue</code>获取<code>G</code></li></ul><h2 id=go-func-的调度流程>Go func 的调度流程</h2><p>直接展示流程图</p><p><img src=/golang%E5%8D%8F%E7%A8%8B%E6%B1%A0%E5%8C%96%E6%8A%80%E6%9C%AF/gofunc%E8%B0%83%E5%BA%A6%E6%B5%81%E7%A8%8B.png alt=gofunc调度流程></p><ul><li><code>go func</code> 开启一个 <code>goroutine</code></li><li>两种类型的存储<code>G</code>的<code>queue</code>, 一种<code>P Local Queue</code>，一种<code>Global Queue</code>。新创建的<code>G</code>会优先保存在<code>P</code>的<code>Local queue</code>，如果<code>P Local Queue</code>满了就会保存到<code>Global Queue</code>。</li><li><code>G</code>运行的载体是<code>M</code>（即线程）, 且一个<code>M</code>必须持有一个<code>P</code>，<code>M:P</code> = <code>1:1</code>。<code>M</code>会从<code>P Local Queue</code>获取一个可执行状态的<code>G</code>来执行，如果<code>P Local Queue</code>为空，会从<code>Global Queue</code>获取一批可执行的<code>G</code>或者从其他<code>MP</code>组合获取一半的可执行的<code>G</code>来存储到其所关联的<code>Local Queue</code>来执行。</li><li><code>M</code>循环的从<code>P</code>中获取<code>G</code>来执行的</li><li>当<code>M</code>执行某个<code>G</code>时候如果发生<code>syscall</code>或者其他<code>block</code>操作，<code>M</code>阻塞了，如果当前还有一下其他的<code>G</code>在执行，<code>runtime</code>会把这个线程<code>M</code>从<code>P</code>中<code>detach</code>，创建一个新的<code>M</code>(如果空闲从空闲中获取)来服务这个<code>P</code>。</li><li><code>M</code> 调用结束，<code>G</code> 尝试获取一个空闲的 <code>P</code> 执行，并放入到 这个 <code>P Local Queue</code>，如果获取不到 <code>P</code>， 那么线程<code>M</code>进入 休眠状态，加入到空闲线程中，这个 <code>G</code> 会被存放到 <code>Global Queue</code> 中。</li></ul><h2 id=总结论调>总结论调</h2><p>上面了解 <code>Golang</code> 实现协程机制 与 <code>goroutine</code> 的调度机制，那么 <code>Golang</code> 开发需要做<code>池化</code>么?</p><p>要论述次问题，需要做的是结合真实应用场景。</p><ul><li>假设是一个小型的项目，且机器的配置完全撑的住预知的并发量，对 <code>goroutine</code> 做池化就没必要了。当然不排除后续需要的进行的优化。</li><li>但是针对一个现有的互联网、物联网等商业环境上，绝大部分生产系统在个人认为还是都是需要做池化动作的。</li></ul><p>需求场景描述:
当一个百万主播开启直播，在该网红要直播的时候，要对其大量的订阅粉丝进行推送直播开启通知的。</p><p><code>Memory</code>上: 直接依赖<code>goroutine</code>的设计，将粉丝都处理出来，依赖非同步的批量处理来并行处理（开启每个<code>goroutine</code>进行<code>200</code>个的订阅粉丝通知操作）。
假设一个机器使用<code>2GB</code>的<code>Memory</code>，每个<code>goroutine</code>是<code>2KB</code>，则理论上能开启<code>100w</code>个初始化状态的<code>goroutine</code>, 但实际上每个<code>goroutine</code>的大小跟随开启的数目而增长上去。
在考虑到系统预留等，和其他情况取<code>1/10</code>的作为稳定状态，同样的配置在一台机器上只能跑<code>10w</code>个<code>goroutine</code>，
那么在之前的需求，一个百万粉丝的主播开播，这样光完成一个主播就需要在一瞬间启动<code>1w</code>个<code>goroutine</code>，那么在高峰热门时段，一台机器最多也只支撑了<code>10</code>个主播开播。且高频率开启销毁 <code>goroutine</code> 造成<code>CPU``100%</code>。</p><p>总结上述操作问题:</p><ul><li>需要一个限制<code>goroutine</code>最多数量</li><li>需要缓存临时存储，让有限的<code>goroutine</code>能缓冲的消化掉</li><li><code>goroutine</code>能重用，减少产生的代价</li></ul><p>综合看完，这就是一个池化的设计实现方式。</p><ul><li>第一点管理<code>goroutine</code>, 使用一个 <code>goroutine</code> array 来管理</li><li>缓存设计，设计<code>queue</code>, goroutine 的协作通信通过 channel, channel(<a href=https://www.golangprograms.com/go-language/channels.html>unbuffered channel 、buffered channel</a>) 使用这个作为 <code>queue</code>，预设置0(走<code>unbuffered channel</code>)，其他的可以设置 <code>queue</code>的长度,走<code>buffered channel</code>机制，</li><li><code>goroutine</code>能重用，开始创建的时候，预设置一个初始的大小，并且设置一个最大的 <code>pool</code> 最大限制。 在初始的时候只创建核心的，然后随着任务的增长和需求赠度，慢慢的增长数量直至达到<code>pool</code>的限制。策略上优先任务放入到<code>queue</code>,<code>queue</code>满了后再新建<code>goroutine</code>去执行并加入到<code>pool</code>, 这样的设计，在突发情况能应接。当系统空闲，能将过多的<code>goroutine</code> 进行回收回复到初始化大小。</li></ul><p>当然也有其他的优秀的开源池化组件，当前</p><ul><li><a href=https://github.com/Jeffail/tunny>tunny</a></li><li><a href=https://github.com/panjf2000/ants>ants</a></li></ul><p>Ref:</p><ul><li><a href=https://gobyexample.com/goroutines>Go by Example: Goroutines</a></li><li><a href=https://stackoverflow.com/questions/8509152/max-number-of-goroutines/8534711#8534711>Max number of goroutines</a></li><li><a href=https://medium.com/a-journey-with-go/go-how-does-the-goroutine-stack-size-evolve-447fc02085e5>Go: How Does the Goroutine Stack Size Evolve</a></li><li><a href=https://excalidraw.com/>excalidraw</a></li></ul></div></article><div class=blog-post-comments><div id=disqus_thread><script type=text/javascript>(function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="pinkhello",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&text=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&title=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&is_video=false&description=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&title=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&title=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&name=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1&description=Why%20Pool%ef%bc%9f%20%e5%85%88%e5%9f%8b%e5%9d%91%3a%20Go%20%e6%9c%89%e6%b2%a1%e6%9c%89%e6%b1%a0%e5%8c%96%e7%9a%84%e5%bf%85%e8%a6%81%3f%20%e4%b8%ba%e4%bb%80%e4%b9%88%e8%a6%81%e6%b1%a0%e5%8c%96%3f%20Go%20%e8%87%aa%e4%bb%8e%e5%87%ba%e7%94%9f%e4%bb%a5%e6%9d%a5%e9%83%bd%e8%a2%ab%e6%88%91%e4%bb%ac%e5%86%a0%e4%bb%a5%26quot%3b%e9%ab%98%e5%b9%b6%e5%8f%91%26quot%3b%e7%9a%84Tag%2c%20%e5%9b%9e%e5%a4%b4%e7%bb%86%e6%83%b3%e5%92%8c%e6%b7%b1%e7%a9%b6%e4%b8%80%e4%b8%8b%ef%bc%8c%e4%bd%a0%e4%bc%9a%e5%8f%91%e7%8e%b0%e5%85%b6%e5%ae%9e%e9%83%bd%e6%98%af%e7%94%b1%20goroutine%20%e5%ae%9e%e7%8e%b0%e7%9a%84%20%2c%20%e6%88%91%e4%bb%ac%e9%83%bd%e7%9f%a5%e9%81%93%20%e4%b8%8e%20Thread%20%e7%9b%b8%e6%af%94%ef%bc%8c%20%e5%88%9b%e5%bb%ba%20Goroutine%20%e7%9a%84%e4%bb%a3%e4%bb%b7%e9%9d%9e%e5%b8%b8%e5%b0%8f%e3%80%82%e4%bb%8e%e7%a8%8b%e5%ba%8f%e8%a1%a8%e7%8e%b0%e4%b8%8a%ef%bc%8c%e4%b9%9f%e5%83%8f%e6%9e%81%e4%ba%86Thread%2c%20%e6%af%8f%e4%b8%aa%20Program%20%e8%87%b3%e5%b0%91%e5%8c%85%e5%90%ab%e4%b8%80%e4%b8%aa%20Goroutine%28%e8%87%b3%e5%b0%91%e4%b8%80%e4%b8%aa%2a%2aMain%20Goroutine%2a%2a%29%20%e6%89%80%e6%9c%89%e7%9a%84%e5%85%b6%e4%bb%96%20Goroutines%20%e9%83%bd%e4%be%9d%e9%99%84%e4%ba%8e%20Main%20Goroutine%ef%bc%88%e5%a6%82%e6%9e%9c%20Main%20Goroutine%20Terminated%2c%20%e5%85%b6%e4%bb%96%20Goroutines%20%e4%b9%9f%e4%bc%9a%20Terminated%ef%bc%89%2c%20Goroutine%20%e6%80%bb%e6%98%af%e5%b7%a5%e4%bd%9c%e5%9c%a8%e5%90%8e%e5%8f%b0%e3%80%82%0a%e5%a4%9a%e7%ba%bf%e7%a8%8b%60%60%e5%a4%9a%e8%bf%9b%e7%a8%8b%e6%98%af%e4%b8%ba%e4%ba%86%e6%8f%90%e9%ab%98%e7%b3%bb%e7%bb%9f%e7%9a%84%e5%b9%b6%e5%8f%91%e8%83%bd%e5%8a%9b%ef%bc%8c%e5%bd%93%e5%89%8d%e7%b3%bb%e7%bb%9f%e4%b8%8b%ef%bc%8c%e8%bf%99%e8%be%b9%e5%b0%b1%e9%9c%80%e8%a6%81%e7%b3%bb%e7%bb%9f%e8%b0%83%e5%ba%a6%ef%bc%8c%e4%b8%80%e4%b8%aa%e7%ba%bf%e7%a8%8b%e5%8f%af%e4%bb%a5%e6%8b%86%e5%88%86%e4%b8%ba%20%26quot%3b%e7%94%a8%e6%88%b7%e6%80%81%26quot%3b%e7%ba%bf%e7%a8%8b%20%e5%92%8c%20%26quot%3b%e5%86%85%e6%a0%b8%e6%80%81%26quot%3b%e7%ba%bf%e7%a8%8b%ef%bc%8c%e8%bf%99%e4%b8%a4%e8%80%85%e9%9c%80%e8%a6%81%e8%bf%9b%e8%a1%8c%e7%bb%91%e5%ae%9a%ef%bc%8c%e6%88%91%e4%bb%ac%e4%b8%80%e8%88%ac%e7%a7%b0%20%e5%86%85%e6%a0%b8%e6%80%81%e7%ba%bf%e7%a8%8b%20%e4%b8%ba%e7%ba%bf%e7%a8%8b%ef%bc%8c%e7%94%a8%e6%88%b7%e6%80%81%e7%ba%bf%e7%a8%8b%e4%b8%ba%e5%8d%8f%e7%a8%8b%0a%e4%bb%8e%e4%b8%8a%e9%9d%a2%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%87%ba%20%e5%8d%8f%e7%a8%8b%20%e5%92%8c%20%e7%ba%bf%e7%a8%8b%20%e6%9c%89%e6%98%a0%e5%b0%84%e5%85%b3%e7%b3%bb%ef%bc%8c%e8%bf%99%e6%a0%b7%e5%b0%b1%e6%9d%a5%e4%ba%86%20M%3aN%20%e5%85%b3%e7%b3%bb%28%e4%b8%ba%e4%bb%80%e4%b9%88%e4%b8%8d%e6%98%af%201%3a1%2c%20N%3a1%20%3f%20%29%0aGoroutine%20%e4%bc%98%e7%82%b9%3a%0a%e7%9b%b8%e6%af%94%20Thread%20%e4%bb%a3%e4%bb%b7%e6%9b%b4%e5%b0%8f%20Goroutine%20%e5%85%b6%e5%9c%a8%20stack%20%e7%9a%84%e5%a4%a7%e5%b0%8f%e5%8f%af%e4%bb%a5%e6%a0%b9%e6%8d%ae%e7%a8%8b%e5%ba%8f%e8%a6%81%e6%b1%82%e8%bf%9b%e8%a1%8c%e5%8f%98%e5%8c%96%ef%bc%8c%e4%bd%86%e6%98%af%20Thread%20%e6%98%af%e5%9b%ba%e5%ae%9a%e7%9a%84%20Goroutine%20%e4%bd%bf%e7%94%a8%20Channel%20%e8%bf%9b%e8%a1%8c%e9%80%9a%e4%bf%a1%ef%bc%8cChannel%20%e7%94%a8%e4%ba%8e%20Goroutines%20%e8%ae%bf%e9%97%ae%e5%85%b1%e4%ba%ab%e5%86%85%e5%ad%98%e7%9a%84%e6%97%b6%e5%80%99%e9%98%b2%e6%ad%a2%e7%ab%9e%e4%ba%89%e7%9a%84%e3%80%82%20%e4%bb%8e%e7%a8%8b%e5%ba%8f%e4%b8%8a%e4%b8%80%e4%b8%aa%e7%ba%bf%e7%a8%8b%e5%8f%af%e8%83%bd%e6%8b%a5%e6%9c%89%e8%ae%b8%e5%a4%9a%e7%9a%84%20Goroutines%20%e5%85%b3%e8%81%94%ef%bc%8c%e5%a6%82%e6%9e%9c%e8%bf%99%e4%ba%9b%e5%85%b3%e8%81%94%e7%9a%84%20%e6%9c%89%e4%b8%80%e4%b8%aa%20Goroutine%20%e5%8e%bb%e9%98%bb%e5%a1%9e%e4%ba%86%e7%ba%bf%e7%a8%8b%ef%bc%8c%e9%82%a3%e4%b9%88%e5%89%a9%e4%bd%99%e7%9a%84%20Goroutine%20%e5%b0%86%e5%88%86%e9%85%8d%e7%bb%99%e5%85%b6%e4%bb%96%e7%9a%84%20OS%20Thread%ef%bc%8c%e4%b8%94%e8%bf%99%e7%a7%8d%e5%88%87%e6%8d%a2%e6%93%8d%e4%bd%9c%e6%98%af%e5%af%b9%e5%bc%80%e5%8f%91%e8%80%85%e5%b1%8f%e8%94%bd%e7%9a%84%e3%80%82%20Goroutine%20%e8%b0%83%e5%ba%a6%e5%99%a8%20%e5%9b%9e%e5%a4%b4%e7%9c%8b%e5%b0%86%20Goroutine%20%e5%92%8c%20%e5%8d%8f%e7%a8%8b%20%e6%9c%89%e5%8c%ba%e5%88%ab%e7%9a%84%e3%80%82%e8%b0%83%e5%ba%a6" aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2f43-golang%25E7%259A%2584%25E6%25B1%25A0%25E5%258C%2596%25E8%25AE%25BE%25E8%25AE%25A1%2f&t=Golang%e7%9a%84%e6%b1%a0%e5%8c%96%e8%ae%be%e8%ae%a1" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2022 pinkhello</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>