<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Systemd服务笔记 | pinkhello</title><link rel=canonical href=https://pinkhello.cc/posts/systemd%E6%9C%8D%E5%8A%A1%E7%AC%94%E8%AE%B0/><meta name=description content="👷Hey! 我是 **pinkhello**，💻 一名后端程序员。**重要提示**: 在您阅读文章并评论之前，请先认真阅读[**评论承诺**](http://pinkhello.cc/promise)。"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Systemd服务笔记"><meta property="og:description" content="前言 今天离线数仓调度 airflow 任务出现问题，经过查看服务状态，确定是 airflow worker 的存在问题，并行dag最大是数量16，但是发现不止16个, 而查看配置文件是对的，所以就怀疑是启动脚本存在问题。发现启动是以 systemd 服务化启动的，确定了是停止脚本的问题。所以回头来记录一下 systemd 的知识。
systemd 介绍 systemd 是 Linux 的系统基础组件的几个，提供了一个系统和服务管理，运行以 PID 为 1 并负责启动其他程序
systemd 特性 并行启动 按需启动Daemon进程 利用 cgroups 监视进程 支持快照和系统恢复 维护挂载点和自动挂载点 各个服务间的依赖关系精密控制 systemd 基本使用 分析场景
显示系统状态 systemctl status tree 状显示
激活的Unit systemctl 或 systemctl list-units 活动状态的服务
失败的Unit systemctl --failed 所有可用的Unit systemctl list-unit-files /usr/lib/systemd/system/ 和 /etc/systemd/system
显示指的Unit状态 systemctl status <PID> 具体一饿指的的信息
Unit使用
一个配置文件可以描述内容 .service 系统服务、 .mount 挂载点、 .sockets Socket .device 系统设备、.swap 交换分区 、."><meta property="og:type" content="article"><meta property="og:url" content="https://pinkhello.cc/posts/systemd%E6%9C%8D%E5%8A%A1%E7%AC%94%E8%AE%B0/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-09T22:56:19+08:00"><meta property="article:modified_time" content="2022-05-09T22:56:19+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Systemd服务笔记"><meta name=twitter:description content="前言 今天离线数仓调度 airflow 任务出现问题，经过查看服务状态，确定是 airflow worker 的存在问题，并行dag最大是数量16，但是发现不止16个, 而查看配置文件是对的，所以就怀疑是启动脚本存在问题。发现启动是以 systemd 服务化启动的，确定了是停止脚本的问题。所以回头来记录一下 systemd 的知识。
systemd 介绍 systemd 是 Linux 的系统基础组件的几个，提供了一个系统和服务管理，运行以 PID 为 1 并负责启动其他程序
systemd 特性 并行启动 按需启动Daemon进程 利用 cgroups 监视进程 支持快照和系统恢复 维护挂载点和自动挂载点 各个服务间的依赖关系精密控制 systemd 基本使用 分析场景
显示系统状态 systemctl status tree 状显示
激活的Unit systemctl 或 systemctl list-units 活动状态的服务
失败的Unit systemctl --failed 所有可用的Unit systemctl list-unit-files /usr/lib/systemd/system/ 和 /etc/systemd/system
显示指的Unit状态 systemctl status <PID> 具体一饿指的的信息
Unit使用
一个配置文件可以描述内容 .service 系统服务、 .mount 挂载点、 .sockets Socket .device 系统设备、.swap 交换分区 、."><link rel=stylesheet href=https://pinkhello.cc/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><link rel=stylesheet href=https://pinkhello.cc/css/pinkhello.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://pinkhello.cc/images/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-M2FXWC325L","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick='$("html, body").animate({scrollTop:0},"fast")' style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://pinkhello.cc/posts/jvm%E5%86%85%E5%AD%98%E7%BB%93%E6%9E%84jmm/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover='$("#i-prev").toggle()' onmouseout='$("#i-prev").toggle()'></i></a></li><li><a class=icon href=https://pinkhello.cc/jobs/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover='$("#i-next").toggle()' onmouseout='$("#i-next").toggle()'></i></a></li><li><a class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover='$("#i-top").toggle()' onmouseout='$("#i-top").toggle()'></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover='$("#i-share").toggle()' onmouseout='$("#i-share").toggle()' onclick='return $("#share").toggle(),!1'></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&text=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&title=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&is_video=false&description=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&title=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&title=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&name=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0&description=%e5%89%8d%e8%a8%80%20%e4%bb%8a%e5%a4%a9%e7%a6%bb%e7%ba%bf%e6%95%b0%e4%bb%93%e8%b0%83%e5%ba%a6%20airflow%20%e4%bb%bb%e5%8a%a1%e5%87%ba%e7%8e%b0%e9%97%ae%e9%a2%98%ef%bc%8c%e7%bb%8f%e8%bf%87%e6%9f%a5%e7%9c%8b%e6%9c%8d%e5%8a%a1%e7%8a%b6%e6%80%81%ef%bc%8c%e7%a1%ae%e5%ae%9a%e6%98%af%20airflow%20worker%20%e7%9a%84%e5%ad%98%e5%9c%a8%e9%97%ae%e9%a2%98%ef%bc%8c%e5%b9%b6%e8%a1%8cdag%e6%9c%80%e5%a4%a7%e6%98%af%e6%95%b0%e9%87%8f16%ef%bc%8c%e4%bd%86%e6%98%af%e5%8f%91%e7%8e%b0%e4%b8%8d%e6%ad%a216%e4%b8%aa%2c%20%e8%80%8c%e6%9f%a5%e7%9c%8b%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%98%af%e5%af%b9%e7%9a%84%ef%bc%8c%e6%89%80%e4%bb%a5%e5%b0%b1%e6%80%80%e7%96%91%e6%98%af%e5%90%af%e5%8a%a8%e8%84%9a%e6%9c%ac%e5%ad%98%e5%9c%a8%e9%97%ae%e9%a2%98%e3%80%82%e5%8f%91%e7%8e%b0%e5%90%af%e5%8a%a8%e6%98%af%e4%bb%a5%20systemd%20%e6%9c%8d%e5%8a%a1%e5%8c%96%e5%90%af%e5%8a%a8%e7%9a%84%ef%bc%8c%e7%a1%ae%e5%ae%9a%e4%ba%86%e6%98%af%e5%81%9c%e6%ad%a2%e8%84%9a%e6%9c%ac%e7%9a%84%e9%97%ae%e9%a2%98%e3%80%82%e6%89%80%e4%bb%a5%e5%9b%9e%e5%a4%b4%e6%9d%a5%e8%ae%b0%e5%bd%95%e4%b8%80%e4%b8%8b%20systemd%20%e7%9a%84%e7%9f%a5%e8%af%86%e3%80%82%0asystemd%20%e4%bb%8b%e7%bb%8d%20systemd%20%e6%98%af%20Linux%20%e7%9a%84%e7%b3%bb%e7%bb%9f%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%e7%9a%84%e5%87%a0%e4%b8%aa%ef%bc%8c%e6%8f%90%e4%be%9b%e4%ba%86%e4%b8%80%e4%b8%aa%e7%b3%bb%e7%bb%9f%e5%92%8c%e6%9c%8d%e5%8a%a1%e7%ae%a1%e7%90%86%ef%bc%8c%e8%bf%90%e8%a1%8c%e4%bb%a5%20PID%20%e4%b8%ba%201%20%e5%b9%b6%e8%b4%9f%e8%b4%a3%e5%90%af%e5%8a%a8%e5%85%b6%e4%bb%96%e7%a8%8b%e5%ba%8f%0asystemd%20%e7%89%b9%e6%80%a7%20%e5%b9%b6%e8%a1%8c%e5%90%af%e5%8a%a8%20%e6%8c%89%e9%9c%80%e5%90%af%e5%8a%a8Daemon%e8%bf%9b%e7%a8%8b%20%e5%88%a9%e7%94%a8%20cgroups%20%e7%9b%91%e8%a7%86%e8%bf%9b%e7%a8%8b%20%e6%94%af%e6%8c%81%e5%bf%ab%e7%85%a7%e5%92%8c%e7%b3%bb%e7%bb%9f%e6%81%a2%e5%a4%8d%20%e7%bb%b4%e6%8a%a4%e6%8c%82%e8%bd%bd%e7%82%b9%e5%92%8c%e8%87%aa%e5%8a%a8%e6%8c%82%e8%bd%bd%e7%82%b9%20%e5%90%84%e4%b8%aa%e6%9c%8d%e5%8a%a1%e9%97%b4%e7%9a%84%e4%be%9d%e8%b5%96%e5%85%b3%e7%b3%bb%e7%b2%be%e5%af%86%e6%8e%a7%e5%88%b6%20systemd%20%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8%20%e5%88%86%e6%9e%90%e5%9c%ba%e6%99%af%0a%e6%98%be%e7%a4%ba%e7%b3%bb%e7%bb%9f%e7%8a%b6%e6%80%81%20systemctl%20status%20tree%20%e7%8a%b6%e6%98%be%e7%a4%ba%0a%e6%bf%80%e6%b4%bb%e7%9a%84Unit%20systemctl%20%e6%88%96%20systemctl%20list-units%20%e6%b4%bb%e5%8a%a8%e7%8a%b6%e6%80%81%e7%9a%84%e6%9c%8d%e5%8a%a1%0a%e5%a4%b1%e8%b4%a5%e7%9a%84Unit%20systemctl%20--failed%20%e6%89%80%e6%9c%89%e5%8f%af%e7%94%a8%e7%9a%84Unit%20systemctl%20list-unit-files%20%2fusr%2flib%2fsystemd%2fsystem%2f%20%e5%92%8c%20%2fetc%2fsystemd%2fsystem%0a%e6%98%be%e7%a4%ba%e6%8c%87%e7%9a%84Unit%e7%8a%b6%e6%80%81%20systemctl%20status%20%26lt%3bPID%26gt%3b%20%e5%85%b7%e4%bd%93%e4%b8%80%e9%a5%bf%e6%8c%87%e7%9a%84%e7%9a%84%e4%bf%a1%e6%81%af%0aUnit%e4%bd%bf%e7%94%a8%0a%e4%b8%80%e4%b8%aa%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e5%8f%af%e4%bb%a5%e6%8f%8f%e8%bf%b0%e5%86%85%e5%ae%b9%20.service%20%e7%b3%bb%e7%bb%9f%e6%9c%8d%e5%8a%a1%e3%80%81%20.mount%20%e6%8c%82%e8%bd%bd%e7%82%b9%e3%80%81%20.sockets%20Socket%20.device%20%e7%b3%bb%e7%bb%9f%e8%ae%be%e5%a4%87%e3%80%81.swap%20%e4%ba%a4%e6%8d%a2%e5%88%86%e5%8c%ba%20%e3%80%81." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&t=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Systemd服务笔记</h1><div class=meta><div class=postdate><time datetime="2022-05-09 22:56:19 +0800 +0800" itemprop=datePublished>2022-05-09</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/tech>Tech</a></div></div></header><div id=toc><nav id=TableOfContents></nav></div><div class=content itemprop=articleBody><h1 id=前言>前言</h1><p>今天离线数仓调度 <code>airflow</code> 任务出现问题，经过查看服务状态，确定是 <code>airflow worker</code> 的存在问题，并行<code>dag</code>最大是数量<code>16</code>，但是发现不止<code>16</code>个,
而查看配置文件是对的，所以就怀疑是启动脚本存在问题。发现启动是以 <code>systemd</code> 服务化启动的，确定了是停止脚本的问题。所以回头来记录一下 <code>systemd</code> 的知识。</p><h1 id=systemd-介绍><code>systemd</code> 介绍</h1><p><code>systemd</code> 是 <code>Linux</code> 的系统基础组件的几个，提供了一个系统和服务管理，运行以 <code>PID</code> 为 1 并负责启动其他程序</p><h1 id=systemd-特性><code>systemd</code> 特性</h1><ul><li>并行启动</li><li>按需启动<code>Daemon</code>进程</li><li>利用 <code>cgroups</code> 监视进程</li><li>支持快照和系统恢复</li><li>维护挂载点和自动挂载点</li><li>各个服务间的依赖关系精密控制</li></ul><h1 id=systemd-基本使用><code>systemd</code> 基本使用</h1><p>分析场景</p><ul><li>显示系统状态 <code>systemctl status</code></li></ul><blockquote><p>tree 状显示</p></blockquote><ul><li>激活的Unit <code>systemctl</code> 或 <code>systemctl list-units</code></li></ul><blockquote><p>活动状态的服务</p></blockquote><ul><li>失败的Unit <code>systemctl --failed</code></li><li>所有可用的Unit <code>systemctl list-unit-files</code></li></ul><blockquote><p><code>/usr/lib/systemd/system/</code> 和 <code>/etc/systemd/system</code></p></blockquote><ul><li>显示指的Unit状态 <code>systemctl status &lt;PID></code></li></ul><blockquote><p>具体一饿指的的信息</p></blockquote><p>Unit使用</p><blockquote><p>一个配置文件可以描述内容 .service 系统服务、 .mount 挂载点、 .sockets Socket .device 系统设备、.swap 交换分区 、.path 文件路径、等等, 具体查看 <a href=https://man.archlinux.org/man/systemd.unit.5>https://man.archlinux.org/man/systemd.unit.5</a></p></blockquote><ul><li>激活 <code>systemctl start &lt;名称></code></li><li>停止 <code>systemctl stop &lt;名称></code></li><li>重启 <code>systemctl restart &lt;名称></code></li><li>重新加载配置 <code>systemctl reload &lt;名称></code></li><li>状态 <code>systemctl status &lt;名称></code></li><li>是否自动启动 <code>systemctl is-enabled &lt;名称></code></li><li>开机自动启动 <code>systemctl enable &lt;名称></code></li><li>取消自动启动 <code>systemctl disable &lt;名称></code></li><li>禁用 <code>systemctl mask &lt;名称></code></li><li>取消禁用 <code>systemctl unmask &lt;名称></code></li><li>帮助 <code>systemctl help &lt;名称></code></li><li>重新载入 <code>systemd</code> 系统配置 <code>systemctl daemon-reload</code></li></ul><h1 id=systemd-的文件>systemd 的文件</h1><p>Unit 配置文件的位置</p><ul><li><code>/usr/lib/systemd/system</code> 第三方软件的系统Unit</li><li><code>/etc/systemd/system</code> 系统管理员安装的Unit</li></ul><p>Unit 文件的基本构成</p><ul><li><p>第一部分 <code>unit</code>, 记录unit文件的通用信息</p><ul><li>1）<code>Description</code>：名称和基本功能</li><li>2）<code>Documentation</code>：帮助文档</li><li>3）<code>Require</code>：当前服务是需要哪个特定的服务的，比如：<code>Require=nginx.service</code>，这就表示当前服务是需要<code>nginx</code>服务，那么在启动当前这个服务的时候，会自动将<code>nginx</code>也启动起来；而且一旦发现<code>nginx</code>服务停止了，那么当前这个服务也就会自动停止 （<code>require</code>无法指定启动次序，需要结合<code>Before</code> <code>After</code>来用，否则经常出现各种问题）</li><li>4）<code>Wants</code>：建议同时启动某服务，比如：<code>Wants=nginx.service</code> 表示系统中最好启动<code>nginx</code>服务，但是即使不启动<code>nginx</code>，当前这个服务也没啥影响</li><li>5）<code>Before</code>：定义启动顺序，例子：Before=nginx.service，表示该服务需要在nginx启动之前启动</li><li>6）<code>After</code>：定义启动顺序，同上</li><li>7）Condition&mldr;=：有许多指令Condition允许管理员在启动单元之前测试某些条件</li><li>8）Assert&mldr;=: 与以 开头的指令类似Condition，这些指令检查运行环境的不同方面以决定单元是否应该激活。但是，与Condition指令不同，否定结果会导致该指令失败。</li></ul></li><li><p>7）<code>Conflicis</code>：当一个服务启动的时候，会立刻停止与之相冲突的服务</p></li><li><p>第二部分 <code>service</code>, 记录service具体信息(启动、配置等)</p><ul><li>1）<code>Type</code>：指定<code>service</code>的类型<ul><li><code>simple</code> : 服务的主进程在 <code>start</code> 行中指定。</li><li><code>forking</code>: 当服务 <code>fork</code> 子进程时使用此服务类型，几乎立即退出父进程。这<code>systemd</code>表明即使父进程退出，该进程仍在运行。需要一个后台守护进程一直在运行，比如运行<code>nginx</code>、<code>apache</code>、<code>sshd</code></li><li><code>oneshot</code>: 程序执行完成就自动结束了，没有后台进程，比如执行一个<code>shell</code></li><li><code>dbus</code>: 这表明该单元将在 <code>D-Bus</code> 总线上命名</li><li><code>notify</code>: 这表示服务将在完成启动时发出通知</li><li><code>idle</code>: 这表示在调度所有作业之前不会运行服务</li></ul></li><li>2）<code>ExecStart</code>：指定如何启动服务（指定启动服务要执行的命令）<ul><li>如果服务类型是<code>oneshot</code>类型，那么可以直接写上他要执行命令即可，通常不能添加参数和选项</li><li>如果服务类型不是<code>oneshot</code>类型，那么在写要执行的命令的时候，可以添加一些参数，比如指定选项、配置文件、用户 (如果要执行多个命令，那么多个命令之间用;分割，如果需要换行可以用 来续行)</li></ul></li><li>3）<code>ExecStartPre</code>, <code>ExecStartPost</code>：指定在执行启动服务之前、之后要执行什么命令</li><li>4）<code>ExecStop</code>：停止服务</li><li>5）<code>ExecStopPost</code>：这可用于指定要在停止命令之后执行的命令。</li><li>6）<code>Restart</code>：表示<code>systemd</code>将尝试自动重新启动服务的情况</li><li>7）<code>PIDFile</code>：指定<code>pid</code>文件的路径</li><li>8）<code>TimeoutSec</code>：这配置<code>systemd</code>在停止或停止服务之前将等待的时间量，然后将其标记为失败或强制终止它</li><li>9）<code>RestartSec</code>：如果启用了自动重新启动服务，则指定在尝试重新启动服务之前等待的时间量。</li><li>10）<code>EnvironmentFile</code>：环境文件配置，使用其中的环境变量</li></ul></li><li><p>第三部分 <code>install</code>, 记录安装信息(运行方式)</p><ul><li><code>WantedBy</code>：指定运行级别， <code>WantedBy=multi-user.target</code></li><li><code>RequiredBy</code>：该指令与指令非常相似<code>WantedBy</code>，但它指定了一个必需的依赖项，如果不满足该依赖项将导致激活失败。</li></ul></li></ul><h1 id=编写一个简单的-unit-文件>编写一个简单的 <code>Unit</code> 文件</h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># /home/xxx/apps/xxx-app-env.conf</span>
</span></span><span style=display:flex><span><span style=color:#75715e># XXX APP 环境变量文件</span>
</span></span><span style=display:flex><span>APP_HOME<span style=color:#f92672>=</span>/home/xxx/apps
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#75715e># This file is the systemd service for XXXXX. Put this file in /usr/lib/systemd/system per default</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Unit<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Description<span style=color:#f92672>=</span>Service <span style=color:#66d9ef>for</span> XXX APP
</span></span><span style=display:flex><span>After<span style=color:#f92672>=</span>mysqld.service
</span></span><span style=display:flex><span>Wants<span style=color:#f92672>=</span>mysqld.service
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Service<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>EnvironmentFile<span style=color:#f92672>=</span>/home/xxx/apps/xxx-app-env.conf
</span></span><span style=display:flex><span>User<span style=color:#f92672>=</span>root
</span></span><span style=display:flex><span>Group<span style=color:#f92672>=</span>root
</span></span><span style=display:flex><span>Type<span style=color:#f92672>=</span>simple
</span></span><span style=display:flex><span>ExecStart<span style=color:#f92672>=</span>/bin/sh -c <span style=color:#e6db74>&#34;/usr/bin/su - xxx -c &#39;java -jar </span><span style=color:#e6db74>${</span>APP_HOME<span style=color:#e6db74>}</span><span style=color:#e6db74>/app.jar &gt; /var/log/xxx/app.log&#39;&#34;</span>
</span></span><span style=display:flex><span>Restart<span style=color:#f92672>=</span>on-failure
</span></span><span style=display:flex><span>RestartSec<span style=color:#f92672>=</span>10s
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Install<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>WantedBy<span style=color:#f92672>=</span>multi-user.target
</span></span></code></pre></div><h1 id=ref>REF</h1><ul><li><a href=https://wiki.archlinux.org/title/systemd>systemd</a></li></ul></div></article><div class=blog-post-comments><div id=disqus_thread><script type=text/javascript>(function(){var t,e=document.createElement("script");e.type="text/javascript",e.async=!0,t="pinkhello",e.src="//"+t+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&text=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&title=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&is_video=false&description=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&title=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&title=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&name=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0&description=%e5%89%8d%e8%a8%80%20%e4%bb%8a%e5%a4%a9%e7%a6%bb%e7%ba%bf%e6%95%b0%e4%bb%93%e8%b0%83%e5%ba%a6%20airflow%20%e4%bb%bb%e5%8a%a1%e5%87%ba%e7%8e%b0%e9%97%ae%e9%a2%98%ef%bc%8c%e7%bb%8f%e8%bf%87%e6%9f%a5%e7%9c%8b%e6%9c%8d%e5%8a%a1%e7%8a%b6%e6%80%81%ef%bc%8c%e7%a1%ae%e5%ae%9a%e6%98%af%20airflow%20worker%20%e7%9a%84%e5%ad%98%e5%9c%a8%e9%97%ae%e9%a2%98%ef%bc%8c%e5%b9%b6%e8%a1%8cdag%e6%9c%80%e5%a4%a7%e6%98%af%e6%95%b0%e9%87%8f16%ef%bc%8c%e4%bd%86%e6%98%af%e5%8f%91%e7%8e%b0%e4%b8%8d%e6%ad%a216%e4%b8%aa%2c%20%e8%80%8c%e6%9f%a5%e7%9c%8b%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e6%98%af%e5%af%b9%e7%9a%84%ef%bc%8c%e6%89%80%e4%bb%a5%e5%b0%b1%e6%80%80%e7%96%91%e6%98%af%e5%90%af%e5%8a%a8%e8%84%9a%e6%9c%ac%e5%ad%98%e5%9c%a8%e9%97%ae%e9%a2%98%e3%80%82%e5%8f%91%e7%8e%b0%e5%90%af%e5%8a%a8%e6%98%af%e4%bb%a5%20systemd%20%e6%9c%8d%e5%8a%a1%e5%8c%96%e5%90%af%e5%8a%a8%e7%9a%84%ef%bc%8c%e7%a1%ae%e5%ae%9a%e4%ba%86%e6%98%af%e5%81%9c%e6%ad%a2%e8%84%9a%e6%9c%ac%e7%9a%84%e9%97%ae%e9%a2%98%e3%80%82%e6%89%80%e4%bb%a5%e5%9b%9e%e5%a4%b4%e6%9d%a5%e8%ae%b0%e5%bd%95%e4%b8%80%e4%b8%8b%20systemd%20%e7%9a%84%e7%9f%a5%e8%af%86%e3%80%82%0asystemd%20%e4%bb%8b%e7%bb%8d%20systemd%20%e6%98%af%20Linux%20%e7%9a%84%e7%b3%bb%e7%bb%9f%e5%9f%ba%e7%a1%80%e7%bb%84%e4%bb%b6%e7%9a%84%e5%87%a0%e4%b8%aa%ef%bc%8c%e6%8f%90%e4%be%9b%e4%ba%86%e4%b8%80%e4%b8%aa%e7%b3%bb%e7%bb%9f%e5%92%8c%e6%9c%8d%e5%8a%a1%e7%ae%a1%e7%90%86%ef%bc%8c%e8%bf%90%e8%a1%8c%e4%bb%a5%20PID%20%e4%b8%ba%201%20%e5%b9%b6%e8%b4%9f%e8%b4%a3%e5%90%af%e5%8a%a8%e5%85%b6%e4%bb%96%e7%a8%8b%e5%ba%8f%0asystemd%20%e7%89%b9%e6%80%a7%20%e5%b9%b6%e8%a1%8c%e5%90%af%e5%8a%a8%20%e6%8c%89%e9%9c%80%e5%90%af%e5%8a%a8Daemon%e8%bf%9b%e7%a8%8b%20%e5%88%a9%e7%94%a8%20cgroups%20%e7%9b%91%e8%a7%86%e8%bf%9b%e7%a8%8b%20%e6%94%af%e6%8c%81%e5%bf%ab%e7%85%a7%e5%92%8c%e7%b3%bb%e7%bb%9f%e6%81%a2%e5%a4%8d%20%e7%bb%b4%e6%8a%a4%e6%8c%82%e8%bd%bd%e7%82%b9%e5%92%8c%e8%87%aa%e5%8a%a8%e6%8c%82%e8%bd%bd%e7%82%b9%20%e5%90%84%e4%b8%aa%e6%9c%8d%e5%8a%a1%e9%97%b4%e7%9a%84%e4%be%9d%e8%b5%96%e5%85%b3%e7%b3%bb%e7%b2%be%e5%af%86%e6%8e%a7%e5%88%b6%20systemd%20%e5%9f%ba%e6%9c%ac%e4%bd%bf%e7%94%a8%20%e5%88%86%e6%9e%90%e5%9c%ba%e6%99%af%0a%e6%98%be%e7%a4%ba%e7%b3%bb%e7%bb%9f%e7%8a%b6%e6%80%81%20systemctl%20status%20tree%20%e7%8a%b6%e6%98%be%e7%a4%ba%0a%e6%bf%80%e6%b4%bb%e7%9a%84Unit%20systemctl%20%e6%88%96%20systemctl%20list-units%20%e6%b4%bb%e5%8a%a8%e7%8a%b6%e6%80%81%e7%9a%84%e6%9c%8d%e5%8a%a1%0a%e5%a4%b1%e8%b4%a5%e7%9a%84Unit%20systemctl%20--failed%20%e6%89%80%e6%9c%89%e5%8f%af%e7%94%a8%e7%9a%84Unit%20systemctl%20list-unit-files%20%2fusr%2flib%2fsystemd%2fsystem%2f%20%e5%92%8c%20%2fetc%2fsystemd%2fsystem%0a%e6%98%be%e7%a4%ba%e6%8c%87%e7%9a%84Unit%e7%8a%b6%e6%80%81%20systemctl%20status%20%26lt%3bPID%26gt%3b%20%e5%85%b7%e4%bd%93%e4%b8%80%e9%a5%bf%e6%8c%87%e7%9a%84%e7%9a%84%e4%bf%a1%e6%81%af%0aUnit%e4%bd%bf%e7%94%a8%0a%e4%b8%80%e4%b8%aa%e9%85%8d%e7%bd%ae%e6%96%87%e4%bb%b6%e5%8f%af%e4%bb%a5%e6%8f%8f%e8%bf%b0%e5%86%85%e5%ae%b9%20.service%20%e7%b3%bb%e7%bb%9f%e6%9c%8d%e5%8a%a1%e3%80%81%20.mount%20%e6%8c%82%e8%bd%bd%e7%82%b9%e3%80%81%20.sockets%20Socket%20.device%20%e7%b3%bb%e7%bb%9f%e8%ae%be%e5%a4%87%e3%80%81.swap%20%e4%ba%a4%e6%8d%a2%e5%88%86%e5%8c%ba%20%e3%80%81." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2fsystemd%25E6%259C%258D%25E5%258A%25A1%25E7%25AC%2594%25E8%25AE%25B0%2f&t=Systemd%e6%9c%8d%e5%8a%a1%e7%ac%94%e8%ae%b0" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick='return $("#nav-footer").toggle(),!1' aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick='return $("#share-footer").toggle(),!1' aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick='$("html, body").animate({scrollTop:0},"fast")' aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2022 pinkhello</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
<script>MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},svg:{fontCache:"global"}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>