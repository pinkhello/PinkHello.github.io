<!doctype html><html lang=en-us><head><link rel=preload href=/lib/font-awesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/font-awesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin=anonymous><link rel=preload href=/lib/JetBrainsMono/web/woff2/JetBrainsMono-Regular.woff2 as=font type=font/woff2 crossorigin=anonymous><script type=text/javascript src=https://latest.cactus.chat/cactus.js></script>
<link rel=stylesheet href=https://latest.cactus.chat/style.css type=text/css><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>如何构建一个简单的RPC调用 | pinkhello</title><link rel=canonical href=https://pinkhello.cc/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/><meta name=description content="👷Hey! 我是 **pinkhello**，💻 一名后端程序员。**重要提示**: 在您阅读文章并评论之前，请先认真阅读[**评论承诺**](http://pinkhello.cc/promise)。"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="如何构建一个简单的RPC调用"><meta property="og:description" content="1、什么叫RPC?
RPC构成
RPC Consumer RPC Provider ConfigServer 1、Provider 启动 ConfigServer 注册服务 2、Consumer 启动 ConfigServer 订阅服务， 3、发起调用 Consumer &mdash;> Provider 4、响应调用 Consumer <&mdash; Provider 2、什么是 Netty ? https://netty.io/
3、现有的开源的项目是否使用了 Netty ?
Dubbo Grpc Spark &mldr;. 4、RPC Provider 启动
Netty Server 方式启动 Rpc 服务的注册 5、RPC Consumer 启动
Netty Client 方式启动 RPC 泛化调用、通过字节码基于反射来实现远程调度 Consumer 服务订阅 启动时建立长连接 6、从第四可以看出，多个 Provider 是由一个 NettyServer 提供的，通过 HandlerMap 映射找到对应的 Ioc Bean，完成服务调用
服务端 EventLoopGroup bossGroup = new NioEventLoopGroup(1); EventLoopGroup workerGroup = new NioEventLoopGroup(); try { ServerBootstrap b = new ServerBootstrap(); b."><meta property="og:type" content="article"><meta property="og:url" content="https://pinkhello.cc/posts/04-%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rpc%E8%B0%83%E7%94%A8/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-02-13T10:00:00+08:00"><meta property="article:modified_time" content="2019-02-13T10:00:00+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="如何构建一个简单的RPC调用"><meta name=twitter:description content="1、什么叫RPC?
RPC构成
RPC Consumer RPC Provider ConfigServer 1、Provider 启动 ConfigServer 注册服务 2、Consumer 启动 ConfigServer 订阅服务， 3、发起调用 Consumer &mdash;> Provider 4、响应调用 Consumer <&mdash; Provider 2、什么是 Netty ? https://netty.io/
3、现有的开源的项目是否使用了 Netty ?
Dubbo Grpc Spark &mldr;. 4、RPC Provider 启动
Netty Server 方式启动 Rpc 服务的注册 5、RPC Consumer 启动
Netty Client 方式启动 RPC 泛化调用、通过字节码基于反射来实现远程调度 Consumer 服务订阅 启动时建立长连接 6、从第四可以看出，多个 Provider 是由一个 NettyServer 提供的，通过 HandlerMap 映射找到对应的 Ioc Bean，完成服务调用
服务端 EventLoopGroup bossGroup = new NioEventLoopGroup(1); EventLoopGroup workerGroup = new NioEventLoopGroup(); try { ServerBootstrap b = new ServerBootstrap(); b."><link rel=stylesheet href=https://pinkhello.cc/css/styles.94f653e9e151e28067a7c5dbbc4600cbd5a3c721e79faaf971e523c40f3b249b8e4f20bb57810dfffa8d559ca5c140fd56eb4cd9c0853113ad08e66afdb08bdd.css integrity="sha512-lPZT6eFR4oBnp8XbvEYAy9WjxyHnn6r5ceUjxA87JJuOTyC7V4EN//qNVZylwUD9VutM2cCFMROtCOZq/bCL3Q=="><link rel=stylesheet href=https://pinkhello.cc/css/pinkhello.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script>
<script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://pinkhello.cc/images/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga('create','G-M2FXWC325L','auto'),ga('send','pageview'))</script><script async src=https://www.google-analytics.com/analytics.js></script></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a>
<a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast')" style=display:none aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg"></i></a>
<span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://pinkhello.cc/posts/03-string%E4%B8%BA%E4%BB%80%E4%B9%88%E8%AE%BE%E8%AE%A1%E6%88%90final/ aria-label=Previous><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle()" onmouseout="$('#i-prev').toggle()"></i></a></li><li><a class=icon href=https://pinkhello.cc/about/ aria-label=Next><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle()" onmouseout="$('#i-next').toggle()"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle()" onmouseout="$('#i-top').toggle()"></i></a></li><li><a class=icon href=# aria-label=Share><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle()" onmouseout="$('#i-share').toggle()" onclick="return $('#share').toggle(),!1"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f" aria-label=Facebook><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&text=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label=Twitter><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&title=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label=Linkedin><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&is_video=false&description=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label=Pinterest><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f" aria-label=Email><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&title=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label=Pocket><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&title=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label=reddit><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&name=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8&description=1%e3%80%81%e4%bb%80%e4%b9%88%e5%8f%abRPC%3f%0aRPC%e6%9e%84%e6%88%90%0aRPC%20Consumer%20RPC%20Provider%20ConfigServer%201%e3%80%81Provider%20%e5%90%af%e5%8a%a8%20ConfigServer%20%e6%b3%a8%e5%86%8c%e6%9c%8d%e5%8a%a1%202%e3%80%81Consumer%20%e5%90%af%e5%8a%a8%20ConfigServer%20%e8%ae%a2%e9%98%85%e6%9c%8d%e5%8a%a1%ef%bc%8c%203%e3%80%81%e5%8f%91%e8%b5%b7%e8%b0%83%e7%94%a8%20Consumer%20%26mdash%3b%26gt%3b%20Provider%204%e3%80%81%e5%93%8d%e5%ba%94%e8%b0%83%e7%94%a8%20Consumer%20%26lt%3b%26mdash%3b%20Provider%202%e3%80%81%e4%bb%80%e4%b9%88%e6%98%af%20Netty%20%3f%20https%3a%2f%2fnetty.io%2f%0a3%e3%80%81%e7%8e%b0%e6%9c%89%e7%9a%84%e5%bc%80%e6%ba%90%e7%9a%84%e9%a1%b9%e7%9b%ae%e6%98%af%e5%90%a6%e4%bd%bf%e7%94%a8%e4%ba%86%20Netty%20%3f%0aDubbo%20Grpc%20Spark%20%26hellip%3b.%204%e3%80%81RPC%20Provider%20%e5%90%af%e5%8a%a8%0aNetty%20Server%20%e6%96%b9%e5%bc%8f%e5%90%af%e5%8a%a8%20Rpc%20%e6%9c%8d%e5%8a%a1%e7%9a%84%e6%b3%a8%e5%86%8c%205%e3%80%81RPC%20Consumer%20%e5%90%af%e5%8a%a8%0aNetty%20Client%20%e6%96%b9%e5%bc%8f%e5%90%af%e5%8a%a8%20RPC%20%e6%b3%9b%e5%8c%96%e8%b0%83%e7%94%a8%e3%80%81%e9%80%9a%e8%bf%87%e5%ad%97%e8%8a%82%e7%a0%81%e5%9f%ba%e4%ba%8e%e5%8f%8d%e5%b0%84%e6%9d%a5%e5%ae%9e%e7%8e%b0%e8%bf%9c%e7%a8%8b%e8%b0%83%e5%ba%a6%20Consumer%20%e6%9c%8d%e5%8a%a1%e8%ae%a2%e9%98%85%20%e5%90%af%e5%8a%a8%e6%97%b6%e5%bb%ba%e7%ab%8b%e9%95%bf%e8%bf%9e%e6%8e%a5%206%e3%80%81%e4%bb%8e%e7%ac%ac%e5%9b%9b%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%87%ba%ef%bc%8c%e5%a4%9a%e4%b8%aa%20Provider%20%e6%98%af%e7%94%b1%e4%b8%80%e4%b8%aa%20NettyServer%20%e6%8f%90%e4%be%9b%e7%9a%84%ef%bc%8c%e9%80%9a%e8%bf%87%20HandlerMap%20%e6%98%a0%e5%b0%84%e6%89%be%e5%88%b0%e5%af%b9%e5%ba%94%e7%9a%84%20Ioc%20Bean%ef%bc%8c%e5%ae%8c%e6%88%90%e6%9c%8d%e5%8a%a1%e8%b0%83%e7%94%a8%0a%e6%9c%8d%e5%8a%a1%e7%ab%af%20EventLoopGroup%20bossGroup%20%3d%20new%20NioEventLoopGroup%281%29%3b%20EventLoopGroup%20workerGroup%20%3d%20new%20NioEventLoopGroup%28%29%3b%20try%20%7b%20ServerBootstrap%20b%20%3d%20new%20ServerBootstrap%28%29%3b%20b." aria-label=Tumblr><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&t=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label="Hacker News"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">如何构建一个简单的RPC调用</h1><div class=meta><div class=postdate><time datetime="2019-02-13 10:00:00 +0800 +0800" itemprop=datePublished>2019-02-13</time></div><div class=article-category><i class="fas fa-archive"></i>
<a class=category-link href=/categories/tech>Tech</a></div><div class=article-tag><i class="fas fa-tag"></i>
<a class=tag-link href=/tags/rpc rel=tag>Rpc</a></div></div></header><div id=toc><nav id=TableOfContents></nav></div><div class=content itemprop=articleBody><p>1、什么叫RPC?</p><p><img src=/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E8%B0%83%E7%94%A8%E6%9C%8D%E5%8A%A1%E8%BF%87%E7%A8%8B.jpg alt=RPC调用服务过程></p><p>RPC构成</p><ul><li>RPC Consumer</li><li>RPC Provider</li><li>ConfigServer</li></ul><ul><li>1、<code>Provider</code> 启动 <code>ConfigServer</code> 注册服务</li><li>2、<code>Consumer</code> 启动 <code>ConfigServer</code> 订阅服务，</li><li>3、发起调用 <code>Consumer</code> &mdash;> <code>Provider</code></li><li>4、响应调用 <code>Consumer</code> &lt;&mdash; <code>Provider</code></li></ul><p>2、什么是 <code>Netty</code> ? <a href=https://netty.io/>https://netty.io/</a></p><p><img src=/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/netty%E6%A1%86%E6%9E%B6%E5%9B%BE.png alt=netty框架图></p><p>3、现有的开源的项目是否使用了 <code>Netty</code> ?</p><ul><li>Dubbo</li><li>Grpc</li><li>Spark</li><li>&mldr;.</li></ul><p>4、<code>RPC Provider</code> 启动</p><ul><li><code>Netty Server</code> 方式启动</li><li><code>Rpc</code> 服务的注册
<img src=/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E4%B8%8ENetty%E7%BB%93%E5%90%88Provider%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B.png alt=RPC与Netty结合Provider调用过程></li></ul><p>5、<code>RPC Consumer</code> 启动</p><ul><li><code>Netty Client</code> 方式启动</li><li><code>RPC</code> 泛化调用、通过字节码基于反射来实现远程调度</li><li><code>Consumer</code> 服务订阅</li><li>启动时建立长连接
<img src=/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/RPC%E4%B8%8ENetty%E7%BB%93%E5%90%88Consumer%E8%B0%83%E7%94%A8%E8%BF%87%E7%A8%8B.png alt=RPC与Netty结合Consumer调用过程></li></ul><p>6、从第四可以看出，多个 <code>Provider</code> 是由一个 <code>NettyServer</code> 提供的，通过 <code>HandlerMap</code> 映射找到对应的 <code>Ioc Bean</code>，完成服务调用</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>服务端
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>EventLoopGroup bossGroup <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> NioEventLoopGroup<span style=color:#f92672>(</span>1<span style=color:#f92672>);</span>
</span></span><span style=display:flex><span>EventLoopGroup workerGroup <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> NioEventLoopGroup<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    ServerBootstrap b <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> ServerBootstrap<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    b<span style=color:#f92672>.</span><span style=color:#a6e22e>group</span><span style=color:#f92672>(</span>bossGroup<span style=color:#f92672>,</span> workerGroup<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>.</span><span style=color:#a6e22e>channel</span><span style=color:#f92672>(</span>NioServerSocketChannel<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>.</span><span style=color:#a6e22e>option</span><span style=color:#f92672>(</span>ChannelOption<span style=color:#f92672>.</span><span style=color:#a6e22e>SO_BACKLOG</span><span style=color:#f92672>,</span> 100<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>.</span><span style=color:#a6e22e>handler</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> LoggingHandler<span style=color:#f92672>(</span>LogLevel<span style=color:#f92672>.</span><span style=color:#a6e22e>INFO</span><span style=color:#f92672>))</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>.</span><span style=color:#a6e22e>childHandler</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> ChannelInitializer<span style=color:#f92672>&lt;</span>SocketChannel<span style=color:#f92672>&gt;()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initChannel</span><span style=color:#f92672>(</span>SocketChannel ch<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>            ChannelPipeline p <span style=color:#f92672>=</span> ch<span style=color:#f92672>.</span><span style=color:#a6e22e>pipeline</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>            p<span style=color:#f92672>.</span><span style=color:#a6e22e>addLast</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> RpcEncoder<span style=color:#f92672>(</span>RpcRequest<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            p<span style=color:#f92672>.</span><span style=color:#a6e22e>addLast</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> RpcDecoder<span style=color:#f92672>(</span>RpcResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>            p<span style=color:#f92672>.</span><span style=color:#a6e22e>addLast</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> RpcHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}});</span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// Start the server.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     ChannelFuture f <span style=color:#f92672>=</span> b<span style=color:#f92672>.</span><span style=color:#a6e22e>bind</span><span style=color:#f92672>(</span>PORT<span style=color:#f92672>).</span><span style=color:#a6e22e>sync</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// Wait until the server socket is closed.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     f<span style=color:#f92672>.</span><span style=color:#a6e22e>channel</span><span style=color:#f92672>().</span><span style=color:#a6e22e>closeFuture</span><span style=color:#f92672>().</span><span style=color:#a6e22e>sync</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span> <span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Shut down all event loops to terminate all threads.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    bossGroup<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdownGracefully</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>    workerGroup<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdownGracefully</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p><img src=/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/Netty%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%AE%A2%E6%88%B7%E7%AB%AFTCP%E9%93%BE%E6%8E%A5%E4%B8%8A%E7%9A%84%E8%AF%B7%E6%B1%82.jpg alt=Netty如何处理客户端TCP链接上的请求></p><p><img src=/%E5%A6%82%E4%BD%95%E6%9E%84%E5%BB%BARPC%E8%B0%83%E7%94%A8/NettyReactor%E5%B7%A5%E4%BD%9C%E6%A1%86%E6%9E%B6%E5%9B%BE.jpg alt=NettyReactor工作框架图></p><ul><li><code>BossGroup</code> -> 处理客户端的请求</li><li><code>EventGroup</code> —> 处理IO <code>Read/Write</code> 操作、执行任务系统Task、定时任务</li><li><code>ChildChannelHandler</code> 方式是对 <code>ChannelPipeline</code> 的设置、</li><li><code>ChannelPipeline</code> 是相当于任务链的模式, 是一串 <code>ChannelHandler</code> 的实例</li><li><code>ChannelHandlerContext</code> 是 <code>ChannelPipeline</code> 和 <code>ChannelHandler</code> 的关系</li><li>每个链接对于 <code>Sever</code> 端都会创建一个 <code>Channel</code> ，可以将 <code>Channel</code> 理解为 <code>Connection</code> （其实真正的是 <code>Connection</code> 属于 <code>Channel</code> 的一部分）</li><li>每个 <code>Channel</code> 都有一个自己的唯一的 <code>ChannelPipeline</code> 操作，对于其他的 <code>Channel</code> 的 <code>ChannelPipeline</code> 是隔离的</li><li><code>RPC Handler</code> 是我们对于自己的找寻 <code>RPC</code> 服务处理的 <code>Handler</code> 实现</li><li><code>RPC Encoder</code> 是我们对于自己的找寻 <code>RPC</code> 序列化的编码的 <code>Handler</code> 实现</li><li><code>RPC Decoder</code> 是我们对于自己的找寻 <code>RPC</code> 序列化的解码的 <code>Handler</code> 实现</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>客户端
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span> EventLoopGroup group <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> NioEventLoopGroup<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span> <span style=color:#66d9ef>try</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>     Bootstrap b <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> Bootstrap<span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>     b<span style=color:#f92672>.</span><span style=color:#a6e22e>group</span><span style=color:#f92672>(</span>group<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>.</span><span style=color:#a6e22e>channel</span><span style=color:#f92672>(</span>NioSocketChannel<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>.</span><span style=color:#a6e22e>option</span><span style=color:#f92672>(</span>ChannelOption<span style=color:#f92672>.</span><span style=color:#a6e22e>TCP_NODELAY</span><span style=color:#f92672>,</span> <span style=color:#66d9ef>true</span><span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>.</span><span style=color:#a6e22e>handler</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> ChannelInitializer<span style=color:#f92672>&lt;</span>SocketChannel<span style=color:#f92672>&gt;()</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>@Override</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>void</span> <span style=color:#a6e22e>initChannel</span><span style=color:#f92672>(</span>SocketChannel ch<span style=color:#f92672>)</span> <span style=color:#66d9ef>throws</span> Exception <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>         ChannelPipeline p <span style=color:#f92672>=</span> ch<span style=color:#f92672>.</span><span style=color:#a6e22e>pipeline</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>         p<span style=color:#f92672>.</span><span style=color:#a6e22e>addLast</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> RpcEncoder<span style=color:#f92672>(</span>RpcResponse<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>         p<span style=color:#f92672>.</span><span style=color:#a6e22e>addLast</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> RpcDecoder<span style=color:#f92672>(</span>RpcRequest<span style=color:#f92672>.</span><span style=color:#a6e22e>class</span><span style=color:#f92672>));</span>
</span></span><span style=display:flex><span>         p<span style=color:#f92672>.</span><span style=color:#a6e22e>addLast</span><span style=color:#f92672>(</span><span style=color:#66d9ef>new</span> RpcClientHandler<span style=color:#f92672>());</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}});</span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// Start the client.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     ChannelFuture f <span style=color:#f92672>=</span> b<span style=color:#f92672>.</span><span style=color:#a6e22e>connect</span><span style=color:#f92672>(</span>HOST<span style=color:#f92672>,</span> PORT<span style=color:#f92672>).</span><span style=color:#a6e22e>sync</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// Wait until the connection is closed.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     f<span style=color:#f92672>.</span><span style=color:#a6e22e>channel</span><span style=color:#f92672>().</span><span style=color:#a6e22e>closeFuture</span><span style=color:#f92672>().</span><span style=color:#a6e22e>sync</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>}</span> <span style=color:#66d9ef>finally</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>     <span style=color:#75715e>// Shut down the event loop to terminate all threads.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     group<span style=color:#f92672>.</span><span style=color:#a6e22e>shutdownGracefully</span><span style=color:#f92672>();</span>
</span></span><span style=display:flex><span> <span style=color:#f92672>}</span>
</span></span></code></pre></div><p>7、<code>RPC</code> 序列化</p><ul><li>二进制数据</li><li>Hessian</li><li>Avro</li><li>ProtoBuffer (Protobuf)</li><li>JSON</li><li>XML</li></ul><p>8、关于 <code>RPC</code> 的实现思考与技术讨论</p><ul><li>业务方法、因为是收到请求消息而触发的后续动作调用，不做额外设置，肯定是使用的 <code>WorkGroup</code> 里面的线程操作的。
而作为业务层，不应该与底层关联，应该切割开来，势必会引入真的业务侧线程池。
那么如何引用、怎么引用？(关于 业务线程池 与 <code>WorkGroup</code> 的 <code>EvenLoop</code> 的思考 )</li><li>关于 <code>RPC</code> 调用大部分是同步的调用，而 <code>Netty</code> 底层是完全异步事件机制，在RPC框架层面如何实现同步的调用方式的？</li><li>基于 <code>TCP</code> 的长链接调用，在 <code>RPC</code> 上你会想到其他的哪些东东？</li><li>在此环境下，我没有介绍 <code>RPC</code> 服务于 IOC容器的结合，可以思考一下，如何做到 注解机制、<code>JAVA CONFIG</code> 机制、<code>XML SCHEMA</code> 机制来做?<ul><li>GUICE</li><li>SPRING</li><li>SPI</li><li>&mldr;.</li></ul></li></ul></div></article><div class=blog-post-comments><div id=disqus_thread><script type=text/javascript>(function(){var t,e=document.createElement('script');e.type='text/javascript',e.async=!0,t='pinkhello',e.src='//'+t+'.disqus.com/embed.js',(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(e)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f" aria-label=Facebook><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&text=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label=Twitter><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&title=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label=Linkedin><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&is_video=false&description=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label=Pinterest><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8&body=Check out this article: https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f" aria-label=Email><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&title=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label=Pocket><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&title=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label=reddit><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&name=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8&description=1%e3%80%81%e4%bb%80%e4%b9%88%e5%8f%abRPC%3f%0aRPC%e6%9e%84%e6%88%90%0aRPC%20Consumer%20RPC%20Provider%20ConfigServer%201%e3%80%81Provider%20%e5%90%af%e5%8a%a8%20ConfigServer%20%e6%b3%a8%e5%86%8c%e6%9c%8d%e5%8a%a1%202%e3%80%81Consumer%20%e5%90%af%e5%8a%a8%20ConfigServer%20%e8%ae%a2%e9%98%85%e6%9c%8d%e5%8a%a1%ef%bc%8c%203%e3%80%81%e5%8f%91%e8%b5%b7%e8%b0%83%e7%94%a8%20Consumer%20%26mdash%3b%26gt%3b%20Provider%204%e3%80%81%e5%93%8d%e5%ba%94%e8%b0%83%e7%94%a8%20Consumer%20%26lt%3b%26mdash%3b%20Provider%202%e3%80%81%e4%bb%80%e4%b9%88%e6%98%af%20Netty%20%3f%20https%3a%2f%2fnetty.io%2f%0a3%e3%80%81%e7%8e%b0%e6%9c%89%e7%9a%84%e5%bc%80%e6%ba%90%e7%9a%84%e9%a1%b9%e7%9b%ae%e6%98%af%e5%90%a6%e4%bd%bf%e7%94%a8%e4%ba%86%20Netty%20%3f%0aDubbo%20Grpc%20Spark%20%26hellip%3b.%204%e3%80%81RPC%20Provider%20%e5%90%af%e5%8a%a8%0aNetty%20Server%20%e6%96%b9%e5%bc%8f%e5%90%af%e5%8a%a8%20Rpc%20%e6%9c%8d%e5%8a%a1%e7%9a%84%e6%b3%a8%e5%86%8c%205%e3%80%81RPC%20Consumer%20%e5%90%af%e5%8a%a8%0aNetty%20Client%20%e6%96%b9%e5%bc%8f%e5%90%af%e5%8a%a8%20RPC%20%e6%b3%9b%e5%8c%96%e8%b0%83%e7%94%a8%e3%80%81%e9%80%9a%e8%bf%87%e5%ad%97%e8%8a%82%e7%a0%81%e5%9f%ba%e4%ba%8e%e5%8f%8d%e5%b0%84%e6%9d%a5%e5%ae%9e%e7%8e%b0%e8%bf%9c%e7%a8%8b%e8%b0%83%e5%ba%a6%20Consumer%20%e6%9c%8d%e5%8a%a1%e8%ae%a2%e9%98%85%20%e5%90%af%e5%8a%a8%e6%97%b6%e5%bb%ba%e7%ab%8b%e9%95%bf%e8%bf%9e%e6%8e%a5%206%e3%80%81%e4%bb%8e%e7%ac%ac%e5%9b%9b%e5%8f%af%e4%bb%a5%e7%9c%8b%e5%87%ba%ef%bc%8c%e5%a4%9a%e4%b8%aa%20Provider%20%e6%98%af%e7%94%b1%e4%b8%80%e4%b8%aa%20NettyServer%20%e6%8f%90%e4%be%9b%e7%9a%84%ef%bc%8c%e9%80%9a%e8%bf%87%20HandlerMap%20%e6%98%a0%e5%b0%84%e6%89%be%e5%88%b0%e5%af%b9%e5%ba%94%e7%9a%84%20Ioc%20Bean%ef%bc%8c%e5%ae%8c%e6%88%90%e6%9c%8d%e5%8a%a1%e8%b0%83%e7%94%a8%0a%e6%9c%8d%e5%8a%a1%e7%ab%af%20EventLoopGroup%20bossGroup%20%3d%20new%20NioEventLoopGroup%281%29%3b%20EventLoopGroup%20workerGroup%20%3d%20new%20NioEventLoopGroup%28%29%3b%20try%20%7b%20ServerBootstrap%20b%20%3d%20new%20ServerBootstrap%28%29%3b%20b." aria-label=Tumblr><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fpinkhello.cc%2fposts%2f04-%25E5%25A6%2582%25E4%25BD%2595%25E6%259E%2584%25E5%25BB%25BA%25E4%25B8%2580%25E4%25B8%25AA%25E7%25AE%2580%25E5%258D%2595%25E7%259A%2584rpc%25E8%25B0%2583%25E7%2594%25A8%2f&t=%e5%a6%82%e4%bd%95%e6%9e%84%e5%bb%ba%e4%b8%80%e4%b8%aa%e7%ae%80%e5%8d%95%e7%9a%84RPC%e8%b0%83%e7%94%a8" aria-label="Hacker News"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu-toggle class=icon href=# onclick="return $('#nav-footer').toggle(),!1" aria-label=Menu><i class="fas fa-bars fa-lg" aria-hidden=true></i> Menu</a>
<a id=share-toggle class=icon href=# onclick="return $('#share-footer').toggle(),!1" aria-label=Share><i class="fas fa-share-alt fa-lg" aria-hidden=true></i> share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast')" aria-label="Top of Page"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i> Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2022 pinkhello</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/categories>Category</a></li><li><a href=/tags>Tag</a></li><li><a href=/index.xml>Rss</a></li><li><a href=/jobs>Job</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
<script src=/js/code-copy.js></script>
<script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']]},svg:{fontCache:'global'}}</script><script type=text/javascript id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script></html>